<!DOCTYPE html><html lang="zh-cmn-Hans-CN"><head><title>HMR 原理概述</title><meta name="charset" content="utf-8"/><meta name="author" content="xiao"/><meta name="description" content="前段时间学习了 HMR 的原理，于是就尝试给博客加了这个功能，这里大致讲解下在这里的 HMR 的实现。"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="renderer" content="webkit"/><meta name="force-rendering" content="webkit"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><link rel="short icon" href="/images/favicon.d49166d79effe7141443cbb12866f5f5.ico"/><link rel="stylesheet" type="text/css" href="/styles/layout.afccee51719742708660d2a47ce938d1.css"/><link rel="stylesheet" type="text/css" href="/styles/post.d2fab5f40a24b2db660d67aa072ececb.css"/><link rel="stylesheet" type="text/css" href="/posts/2022/hmr-yuan2-li3-gai4-shu4/styles/heading.8940afb475c6e173f4019c0f9d8ca5de.css"/></head><body><header class="main-header-wrapper"><span class="main-header"><a class="main-title" href="/">Dreaming Cat&#x27;s</a><nav class="main-nav"><a href="/" class="main-nav-item">首页</a><a href="/tags/" class="main-nav-item">标签</a><a href="/archive/" class="main-nav-item">归档</a><a href="/posts/about/" class="main-nav-item">关于</a></nav></span></header><article class="main-article-wrapper"><div class="main-article"><section class="post-default"><header class="post-header"><h1 class="post-header-title">HMR 原理概述</h1><time class="post-header-create">2022-07-30</time></header><article class="post-article"><h1 id="%e6%a6%82%e8%bf%b0"><a class="post-anchor" href="#%e6%a6%82%e8%bf%b0">§</a>概述</h1>
<p>HMR 全称 Hot Module Replacement，中文通常翻译为<em>模块热更新</em>，它能够在保持页面状态的情况下动态替换资源模块，提供更好的开发体验。它最初由 Webpack 设计实现，现在已经是前端工程的必备功能。<br/><br/><span class="post-soft-break"></span>主要还是因为写文章的时候，更新一下就刷新一次太麻烦了，就想着整个自动刷信的东西，后来就想到，都自动刷新了，何不一步到位折腾个 HMR 玩玩。于是就看了看源码，上手改了改就折腾出了这个，本文主要就是介绍下我这里是怎么实现 HMR 的，以及和 Webpack 的实现有何不同。</p>
<h1 id="%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86"><a class="post-anchor" href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86">§</a>基本原理</h1>
<p>本身博客就有调试用的虚拟文件服务器，HMR 功能只需要在这上面扩展即可。现在的虚拟文件服务器，其流程是这样的：</p>
<ol>
<li>编译完成</li>
<li>浏览器访问网址</li>
<li>静态服务器从内存中找到对应文件</li>
<li>向网页端发送文件内容</li>
<li>文件变更后重新编译</li>
<li>浏览器刷信页面，回到第二步</li>
</ol>
<p>而添加了 HMR 之后，整个流程是这样的：</p>
<ol>
<li>编译时往前端网页中注入 HMR 客户端入口代码</li>
<li>浏览器访问网址</li>
<li>静态服务器从内存中找到对应文件，并生成注入代码一并返回浏览器</li>
<li>浏览器中初始化页面，并与服务器建立 WebSocket 连接</li>
<li>文件变更后重新编译</li>
<li>计算新生成的文件和旧文件的差异</li>
<li>将所有差异聚合成数据发送至浏览器</li>
<li>浏览器接收数据后执行代码变更逻辑</li>
</ol>
<h2 id="%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84"><a class="post-anchor" href="#%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84">§</a>代码结构</h2>
<p>从上面的流程中可以看出，和之前的静态服务器相比多了三个部分：</p>
<ol>
<li>负责前后端通信的 WebSocket 服务</li>
<li>编译端用于计算编译前后文件变更服务</li>
<li>注入浏览器端的运行时代码</li>
</ol>
<h2 id="websocket%20%e6%9c%8d%e5%8a%a1"><a class="post-anchor" href="#websocket%20%e6%9c%8d%e5%8a%a1">§</a>WebSocket 服务</h2>
<p>因为 HMR 需要后端主动通知前端变更，所以只能使用 WebSocket 服务来建立连接，由于之前的静态服务器使用 Koa 来完成，这里也就直接用<code>koa-websocket</code>来完成 WS 服务了。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">3</li><li class="">4</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22Koa%22%5D%5D">Koa</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">koa</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'koa' or its corresponding type declarations.</li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22Ws%22%5D%5D">Ws</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">koa-websocket</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'koa-websocket' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-keyword-control-type">type</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22WebSocket%22%5D%5D">WebSocket</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">ws</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'ws' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22app%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">app</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22Ws%22%5D%5D">Ws</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-new-expr lsp-keyword-operator-new">new</span> <span class="lsp-meta-var-expr lsp-new-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22Koa%22%5D%5D">Koa</span><span class="lsp-meta-var-expr lsp-new-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-new-expr lsp-meta-brace-round">)</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sockets%22%5D,%22:%20WebSocket%5B%5D%22%5D">sockets</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22WebSocket%22%5D%5D">WebSocket</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">]</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22remove%22%5D,%22:%20(%22,%5B%22parameterName%22,%22sockets%22%5D,%22:%20%22,%5B%22aliasName%22,%22WebSocket%22%5D,%22%5B%5D,%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20%22,%5B%22aliasName%22,%22WebSocket%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">remove</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22sockets%22%5D,%22:%20WebSocket%5B%5D%22%5D">sockets</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22WebSocket%22%5D%5D">WebSocket</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">]</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22WebSocket%22%5D%5D">WebSocket</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function-return lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function-return lsp-support-type-primitive">void</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22app%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">app</span><span class="lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">ws</span><span class="lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">server</span><span class="lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">?.</span><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">on</span><span class="lsp-meta-brace-round">(</span><span class="lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-string-quoted-single">connection</span><span class="lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22WebSocket%22%5D%5D">WebSocket</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sockets%22%5D,%22:%20WebSocket%5B%5D%22%5D">sockets</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-support-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Array%22%5D,%22%3CWebSocket%3E.%22,%5B%22methodName%22,%22push%22%5D,%22(...%22,%5B%22parameterName%22,%22items%22%5D,%22:%20WebSocket%5B%5D):%20%22,%5B%22keyword%22,%22number%22%5D%5D">push</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">on</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-arrow lsp-meta-block lsp-string-quoted-single">close</span><span class="lsp-meta-arrow lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22remove%22%5D,%22:%20(%22,%5B%22parameterName%22,%22sockets%22%5D,%22:%20%22,%5B%22aliasName%22,%22WebSocket%22%5D,%22%5B%5D,%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20%22,%5B%22aliasName%22,%22WebSocket%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">remove</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sockets%22%5D,%22:%20WebSocket%5B%5D%22%5D">sockets</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-keyword-control-export">export</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22broadcast%22%5D,%22(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">broadcast</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">any</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-loop">for</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span> <span class="lsp-meta-function lsp-meta-block lsp-keyword-operator-expression-of">of</span> <span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sockets%22%5D,%22:%20WebSocket%5B%5D%22%5D">sockets</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22socket%22%5D,%22:%20WebSocket%22%5D">socket</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">send</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-constant-json" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22JSON%22%5D,%22:%20%22,%5B%22localName%22,%22JSON%22%5D%5D">JSON</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-function-json" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22JSON%22%5D,%22.%22,%5B%22methodName%22,%22stringify%22%5D,%22(%22,%5B%22parameterName%22,%22value%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22parameterName%22,%22replacer%22%5D,%22?:%20(%22,%5B%22parameterName%22,%22this%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22value%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22parameterName%22,%22space%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D,%22):%20%22,%5B%22keyword%22,%22string%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">stringify</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>其中，<code>broadcast</code>函数即为向前端广播文件变更的方法。</p>
<h2 id="%e5%a4%84%e7%90%86%e6%96%87%e4%bb%b6%e5%8f%98%e6%9b%b4"><a class="post-anchor" href="#%e5%a4%84%e7%90%86%e6%96%87%e4%bb%b6%e5%8f%98%e6%9b%b4">§</a>处理文件变更</h2>
<p>Webpack 为了兼容各种不同的情况，使用了<em>All in JS</em>的模式，即是指所有文件最终都会被转换为 JS 文件处理。在调试时，对每个文件都单独给予独立的编号用于识别，在文件变更触发重新编译时，Webpack 将会使用增量编译仅仅只编译当前文件模块，然后按照首次编译生成的编码将其发送至前端，前端根据编号再去执行更新。</p>
<p>这样写的好处是可以极大的兼容各种情况，但是并不符合我的博客的情况。</p>
<!-- -->
<p>从前文我的博客的架构里可以看出，我的博客编译流程并不是一次性编译完成的，其中实际上是经过了很多小的编译打包，然后运行打包好的代码，最后将这些结果整合起来的，定制化程度太高，并不好直接借用 Webpack 的模式。所以我这里只能对比编译前后所有成品文件的异同，然后将不同的文件整合发送至前端，然后再由前端来判断如何更新。由于博客网站的容量小，这样的工作量是可以接受的，对比 Webpack 的工作流来说反而更简单，因为这种模式并不需要介入编译流程，只需要比肩编译结果的文件即可。</p>
<h2 id="%e6%b3%a8%e5%85%a5%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e8%bf%90%e8%a1%8c%e6%97%b6"><a class="post-anchor" href="#%e6%b3%a8%e5%85%a5%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e8%bf%90%e8%a1%8c%e6%97%b6">§</a>注入浏览器端运行时</h2>
<p>这个运行时包含了诸如建立 WebSocket 连接、接受以及更新页面等等功能，浏览器端的所有更新行为都在这里完成。</p>
<h3 id="%e6%b3%a8%e5%85%a5%e6%96%87%e4%bb%b6%e7%9a%84%e5%8e%9f%e7%90%86"><a class="post-anchor" href="#%e6%b3%a8%e5%85%a5%e6%96%87%e4%bb%b6%e7%9a%84%e5%8e%9f%e7%90%86">§</a>注入文件的原理</h3>
<p>不管再怎么奇怪的功能，在前端它总归是使用 JS 来实现的，所以这里注入入口其实就是给所有 HTML 文件添加一个<code>script</code>标签，这个标签的<code>src</code>指向这个运行时的地址（这个地址一般是虚拟）。然后浏览器读取和加载完整网页后，将会向服务器请求这个地址的文件，此时再在服务器中返回准备好的运行时文件内容即可。</p>
<p>前端渲染模板：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22React%22%5D%5D">React</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-error-token">react</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22HMRClientScriptPath%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22/__internal/dev/hmr_client.js%5C%22%22%5D%5D">HMRClientScriptPath</span> <span class="lsp-sourcex lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-var-exprx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-var-exprx lsp-string-quoted-singlex">/__internal/dev/hmr_client.js</span><span class="lsp-sourcex lsp-meta-var-exprx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-interfacex lsp-storage-type-interfacex">interface</span> <span class="lsp-sourcex lsp-meta-interfacex lsp-entity-name-type-interfacex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22Props%22%5D%5D">Props</span> <span class="lsp-sourcex lsp-meta-interfacex lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-interfacex lsp-meta-field-declarationx lsp-meta-definition-propertyx lsp-variable-object-propertyx" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22Props%22%5D,%22.%22,%5B%22propertyName%22,%22hmr%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">hmr</span><span class="lsp-sourcex lsp-meta-interfacex lsp-meta-field-declarationx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-interfacex lsp-meta-field-declarationx lsp-meta-type-annotationx lsp-support-type-primitivex">boolean</span><span class="lsp-sourcex lsp-meta-interfacex lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-interfacex lsp-punctuation-definition-blockx">}</span></li><li class=""></li><li class=""><span class="lsp-sourcex lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-comment-line-double-slashx"> 公共 layout</span></li><li class=""><span class="lsp-sourcex lsp-meta-export-defaultx lsp-keyword-control-exportx">export</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-keyword-control-defaultx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Layout%22%5D,%22(%22,%5B%22parameterName%22,%22props%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Props%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">default</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Layout%22%5D,%22(%22,%5B%22parameterName%22,%22props%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Props%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">Layout</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22props%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Props%22%5D%5D">props</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22Props%22%5D%5D">Props</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-brace-roundx">(</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">html</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-entity-other-attribute-namex" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22lang%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">lang</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-keyword-operator-assignmentx">=</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-string-quoted-singlex">zh-cmn-Hans-CN</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">head</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx lsp-punctuation-definition-commentx">/*</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx"> code.. </span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx lsp-punctuation-definition-commentx">*/</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-endx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-variable-other-objectx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22props%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Props%22%5D%5D">props</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-variable-other-propertyx" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22Props%22%5D,%22.%22,%5B%22propertyName%22,%22hmr%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">hmr</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-keyword-operator-ternaryx">?</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">script</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-entity-other-attribute-namex" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22type%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">type</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-keyword-operator-assignmentx">=</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-string-quoted-singlex">text/javascript</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-entity-other-attribute-namex" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22src%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">src</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-keyword-operator-assignmentx">=</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-meta-embedded-expressionx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22HMRClientScriptPath%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22/__internal/dev/hmr_client.js%5C%22%22%5D%5D">HMRClientScriptPath</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-meta-tag-attributesx lsp-punctuation-section-embedded-endx">}</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-meta-tagx lsp-punctuation-definition-tag-endx">/&gt;</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-keyword-operator-ternaryx">:</span> <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-endx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx lsp-punctuation-definition-commentx">/*</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx"> code.. </span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx lsp-punctuation-definition-commentx">*/</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-endx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">head</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">body</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx lsp-punctuation-definition-commentx">/*</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx"> code.. </span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-meta-embedded-expressionx lsp-comment-blockx lsp-punctuation-definition-commentx">*/</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx lsp-punctuation-section-embedded-endx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">body</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">html</span><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-meta-brace-roundx">)</span></li><li class=""><span class="lsp-sourcex lsp-meta-export-defaultx lsp-meta-function-expressionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<p>后端服务器：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22build%22%5D%5D">build</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">esbuild</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'esbuild' or its corresponding type declarations.</li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ParameterizedContext%22%5D%5D">ParameterizedContext</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22Next%22%5D%5D">Next</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">koa</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'koa' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22HMRClientScriptPath%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22/__internal/dev/hmr_client.js%5C%22%22%5D%5D">HMRClientScriptPath</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">/__internal/dev/hmr_client.js</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-keyword-control-export">export</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22transformServe%22%5D,%22():%20(%22,%5B%22parameterName%22,%22ctx%22%5D,%22:%20%22,%5B%22aliasName%22,%22ParameterizedContext%22%5D,%22,%20%22,%5B%22parameterName%22,%22next%22%5D,%22:%20%22,%5B%22aliasName%22,%22Next%22%5D,%22)%20=%3E%20%22,%5B%22localName%22,%22Promise%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E%22%5D">transformServe</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-storage-modifier-async">async</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ctx%22%5D,%22:%20ParameterizedContext%22%5D">ctx</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ParameterizedContext%22%5D%5D">ParameterizedContext</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-separator-parameter">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22next%22%5D,%22:%20Next%22%5D">next</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22Next%22%5D%5D">Next</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ctx%22%5D,%22:%20ParameterizedContext%22%5D">ctx</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">path</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-keyword-operator-comparison">!==</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22HMRClientScriptPath%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22/__internal/dev/hmr_client.js%5C%22%22%5D%5D">HMRClientScriptPath</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22next%22%5D,%22:%20Next%22%5D">next</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 运行时代码真实文件路径</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22clientPath%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22xxxx/client.ts%5C%22%22%5D%5D">clientPath</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single">xxxx/client.ts</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-object-binding-pattern-variable lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-object-binding-pattern-variable lsp-variable-object-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">outputFiles</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-object-binding-pattern-variable lsp-punctuation-destructuring">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-object-binding-pattern-variable lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22files%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">files</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-object-binding-pattern-variable lsp-punctuation-definition-binding-pattern-object">}</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-control-flow">await</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22build%22%5D%5D">build</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22entryPoints%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22%5B%5D%22%5D">entryPoints</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22clientPath%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22xxxx/client.ts%5C%22%22%5D%5D">clientPath</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22bundle%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">bundle</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-constant-language-boolean-true">true</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22minify%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">minify</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-constant-language-boolean-false">false</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22sourcemap%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">sourcemap</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">inline</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22write%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">write</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-constant-language-boolean-false">false</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22format%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">format</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">iife</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22outdir%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">outdir</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">/</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22platform%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">platform</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">browser</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22logLevel%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">logLevel</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">warning</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22charset%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">charset</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">utf8</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ctx%22%5D,%22:%20ParameterizedContext%22%5D">ctx</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-support-variable-property-dom" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">body</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22files%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">files</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-array-literal lsp-constant-numeric-decimal">0</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">contents</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>通过这样的方式，每当浏览器端加载页面时，就都会请求运行时代码，在请求之后，服务器也将会实时的把文件编译完成并返回前端，这样前端每次都能获取最新的运行时代码。</p>
<h3 id="websocket%20%e5%89%8d%e7%ab%af%e6%9c%8d%e5%8a%a1"><a class="post-anchor" href="#websocket%20%e5%89%8d%e7%ab%af%e6%9c%8d%e5%8a%a1">§</a>WebSocket 前端服务</h3>
<p>前端的 WS 服务就只有两个操作，初始化和等待后端数据。初始化很好理解，就是创建 WS 服务并绑定更新数据的回调。这个前端有现成的<code>WebSocket</code>类，<code>new</code>一个就成，这里不再赘述，重点还是在更新数据的具体操作上。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="">31</li><li class="">32</li><li class="">33</li><li class="">34</li><li class="">35</li><li class="">36</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22getSocketUrl%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">getSocketUrl</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function-return lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function-return lsp-support-type-primitive">string</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-keyword-control-conditional">if</span> <span class="lsp-meta-brace-round">(</span><span class="lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-string-quoted-single">WebSocket</span><span class="lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span> <span class="lsp-keyword-operator-expression-in">in</span> <span class="lsp-support-variable-dom" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22window%22%5D,%22:%20%22,%5B%22localName%22,%22Window%22%5D,%22%20&%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22moduleName%22,%22globalThis%22%5D%5D">window</span><span class="lsp-meta-brace-round">)</span> <span class="lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-function-call lsp-support-class-console" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22console%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Console%22%5D%5D">console</span><span class="lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-function-call lsp-support-function-console" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22Console%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(...%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-string-quoted-single">Dev Server is running...</span><span class="lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-block lsp-new-expr lsp-keyword-operator-new">new</span> <span class="lsp-meta-block lsp-new-expr lsp-meta-function-call lsp-support-class-dom" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22WebSocket%22%5D,%22:%20%22,%5B%22keyword%22,%22new%22%5D,%22%20(%22,%5B%22parameterName%22,%22url%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22localName%22,%22URL%22%5D,%22,%20%22,%5B%22parameterName%22,%22protocols%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22string%22%5D,%22%5B%5D)%20=%3E%20%22,%5B%22localName%22,%22WebSocket%22%5D%5D">WebSocket</span><span class="lsp-meta-block lsp-new-expr lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-new-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22getSocketUrl%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">getSocketUrl</span><span class="lsp-meta-block lsp-new-expr lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-new-expr lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-new-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-block lsp-new-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-new-expr lsp-string-quoted-single">blog-dev-server</span><span class="lsp-meta-block lsp-new-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-new-expr lsp-meta-brace-round">)</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22WebSocket%22%5D,%22.%22,%5B%22methodName%22,%22addEventListener%22%5D,%22%3C%22,%5B%22stringLiteral%22,%22%5C%22message%5C%22%22%5D,%22%3E(%22,%5B%22parameterName%22,%22type%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22message%5C%22%22%5D,%22,%20%22,%5B%22parameterName%22,%22listener%22%5D,%22:%20(%22,%5B%22parameterName%22,%22this%22%5D,%22:%20%22,%5B%22localName%22,%22WebSocket%22%5D,%22,%20%22,%5B%22parameterName%22,%22ev%22%5D,%22:%20%22,%5B%22localName%22,%22MessageEvent%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E)%20=%3E%20%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22parameterName%22,%22options%22%5D,%22?:%20%22,%5B%22keyword%22,%22boolean%22%5D,%22%20%7C%20%22,%5B%22interfaceName%22,%22AddEventListenerOptions%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">addEventListener</span><span class="lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-string-quoted-single">message</span><span class="lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MessageEvent%22%5D,%22%3C%22,%5B%22keyword%22,%22string%22%5D,%22%3E%22%5D">event</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22MessageEvent%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E%22%5D">MessageEvent</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-support-type-primitive">string</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22updates%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">updates</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-constant-json" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22JSON%22%5D,%22:%20%22,%5B%22localName%22,%22JSON%22%5D%5D">JSON</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-json" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22JSON%22%5D,%22.%22,%5B%22methodName%22,%22parse%22%5D,%22(%22,%5B%22parameterName%22,%22text%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22reviver%22%5D,%22?:%20(%22,%5B%22parameterName%22,%22this%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22value%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22any%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">parse</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-support-variable-dom" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MessageEvent%22%5D,%22%3C%22,%5B%22keyword%22,%22string%22%5D,%22%3E%22%5D">event</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22MessageEvent%22%5D,%22%3C%22,%5B%22keyword%22,%22string%22%5D,%22%3E.%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">data</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-keyword-control-loop">for</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-keyword-operator-expression-of">of</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22updates%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">updates</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-expression-expr lsp-keyword-control-switch">switch</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-expression-expr lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-expression-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-expression-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-expression-expr lsp-variable-other-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">kind</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-expression-expr lsp-meta-brace-round">)</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-keyword-control-switch">case</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single">HTML</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-punctuation-definition-section-case-statement">:</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-comment-line-double-slash"> 更新 HTML</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-keyword-control-loop">break</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-keyword-control-switch">case</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single">CSS</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-punctuation-definition-section-case-statement">:</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-comment-line-double-slash"> 更新 CSS</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-keyword-control-loop">break</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-keyword-control-switch">case</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single">JS</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-punctuation-definition-section-case-statement">:</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-comment-line-double-slash"> 更新 JS</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-keyword-control-loop">break</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-keyword-control-switch">default</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-case-clause-expr lsp-punctuation-definition-section-case-statement">:</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-meta-function-call lsp-support-class-console" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22console%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Console%22%5D%5D">console</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-meta-function-call lsp-support-function-console" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22Console%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(...%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template">Unknown update kind: </span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-keyword-control-as">as</span> <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-support-type-primitive">any</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">kind</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-keyword-control-loop">break</span><span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-switch-block-expr lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-switch-statement-expr lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-keyword-control-conditional">else</span> <span class="lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-function-call lsp-support-class-console" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22console%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Console%22%5D%5D">console</span><span class="lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-function-call lsp-support-function-console" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22Console%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(...%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-block lsp-string-quoted-single">WebSocket is not supported.</span><span class="lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<h1 id="%e5%89%8d%e7%ab%af%e6%9b%b4%e6%96%b0%e6%b5%81%e7%a8%8b"><a class="post-anchor" href="#%e5%89%8d%e7%ab%af%e6%9b%b4%e6%96%b0%e6%b5%81%e7%a8%8b">§</a>前端更新流程</h1>
<p>在前文中我们可以看到，我这里是将所有文件区分开来更新的，针对不同的文件有不同的更新策略。另外，在 Webpack 构成的项目中，不管路由在哪里，都靠着文件 HASH 编码来更新的，所以前端只需要接受所有更新，然后去匹配不同的 HASH 标记的模块就行。而在这里不行，因为没有 HASH 做标记，所以首先需要判断这个更新是不是属于当前页面，不是当前页面的文件就要抛弃。</p>
<h2 id="css%20%e6%9b%b4%e6%96%b0"><a class="post-anchor" href="#css%20%e6%9b%b4%e6%96%b0">§</a>CSS 更新</h2>
<p>CSS 文件更新是最简单的，只需要替换新的<code>link</code>标签即可。但是注意要在链接后面加上新的 hash 编码，这样浏览器才会去读新的文件内容，而不是从缓存里拿。所以它的更新代码大约可以是：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22reloadCSS%22%5D,%22(%22,%5B%22parameterName%22,%22src%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">reloadCSS</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22src%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">src</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-variable-dom" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22document%22%5D,%22:%20%22,%5B%22localName%22,%22Document%22%5D%5D">document</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ParentNode%22%5D,%22.%22,%5B%22methodName%22,%22querySelector%22%5D,%22%3C%22,%5B%22localName%22,%22Element%22%5D,%22%3E(%22,%5B%22parameterName%22,%22selectors%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22localName%22,%22Element%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%224%22%5D,%22%20overloads)%22%5D">querySelector</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template">link[href|=&quot;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22src%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">src</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template">&quot;]</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-keyword-operator-logical">!</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-control-flow">return</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22newLink%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">newLink</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22methodName%22,%22cloneNode%22%5D,%22(%22,%5B%22parameterName%22,%22subtree%22%5D,%22?:%20%22,%5B%22keyword%22,%22boolean%22%5D,%22):%20%22,%5B%22localName%22,%22Node%22%5D%5D">cloneNode</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-control-as">as</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22Element%22%5D%5D">Element</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22newHref%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">newHref</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Element%22%5D,%22.%22,%5B%22methodName%22,%22getAttribute%22%5D,%22(%22,%5B%22parameterName%22,%22qualifiedName%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D%5D">getAttribute</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single">href</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-keyword-operator-logical">??</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-support-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22String%22%5D,%22.%22,%5B%22methodName%22,%22split%22%5D,%22(%22,%5B%22parameterName%22,%22separator%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22localName%22,%22RegExp%22%5D,%22,%20%22,%5B%22parameterName%22,%22limit%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D,%22):%20%22,%5B%22keyword%22,%22string%22%5D,%22%5B%5D%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">split</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single">?</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-array-literal lsp-constant-numeric-decimal">0</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template">?</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Date%22%5D,%22:%20%22,%5B%22interfaceName%22,%22DateConstructor%22%5D%5D">Date</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22DateConstructor%22%5D,%22.%22,%5B%22methodName%22,%22now%22%5D,%22():%20%22,%5B%22keyword%22,%22number%22%5D%5D">now</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22newLink%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">newLink</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Element%22%5D,%22.%22,%5B%22methodName%22,%22setAttribute%22%5D,%22(%22,%5B%22parameterName%22,%22qualifiedName%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22value%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">setAttribute</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-string-quoted-single">href</span><span class="lsp-meta-function lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22newHref%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">newHref</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22newLink%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">newLink</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Element%22%5D,%22.%22,%5B%22methodName%22,%22addEventListener%22%5D,%22(%22,%5B%22parameterName%22,%22type%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22listener%22%5D,%22:%20%22,%5B%22aliasName%22,%22EventListenerOrEventListenerObject%22%5D,%22,%20%22,%5B%22parameterName%22,%22options%22%5D,%22?:%20%22,%5B%22keyword%22,%22boolean%22%5D,%22%20%7C%20%22,%5B%22interfaceName%22,%22AddEventListenerOptions%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">addEventListener</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-string-quoted-single">load</span><span class="lsp-meta-function lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22propertyName%22,%22parentNode%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ParentNode%22%5D%5D">parentNode</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22propertyName%22,%22parentNode%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ParentNode%22%5D%5D">?.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22methodName%22,%22removeChild%22%5D,%22%3C%22,%5B%22localName%22,%22Element%22%5D,%22%3E(%22,%5B%22parameterName%22,%22child%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D,%22):%20%22,%5B%22localName%22,%22Element%22%5D%5D">removeChild</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22propertyName%22,%22parentNode%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ParentNode%22%5D%5D">parentNode</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22propertyName%22,%22parentNode%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ParentNode%22%5D%5D">?.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22methodName%22,%22insertBefore%22%5D,%22%3C%22,%5B%22localName%22,%22Element%22%5D,%22%3E(%22,%5B%22parameterName%22,%22node%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D,%22,%20%22,%5B%22parameterName%22,%22child%22%5D,%22:%20%22,%5B%22localName%22,%22Node%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22localName%22,%22Element%22%5D%5D">insertBefore</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22newLink%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">newLink</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22link%22%5D,%22:%20%22,%5B%22localName%22,%22Element%22%5D%5D">link</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22Node%22%5D,%22.%22,%5B%22propertyName%22,%22nextSibling%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ChildNode%22%5D%5D">nextSibling</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>按照 href 的属性搜索当前页面是否存在此 CSS 元素，若是不存在则直接退出，若是存在，则复制该节点，然后给 href 后添加唯一标识，随后将其添加进文档流，最后当元素加载完成，卸载旧节点。</p>
<h2 id="html%20%e6%9b%b4%e6%96%b0"><a class="post-anchor" href="#html%20%e6%9b%b4%e6%96%b0">§</a>HTML 更新</h2>
<p>HTML 的更新要稍微复杂一些，因为还直接涉及了 JS 页面交互的问题。我本来的想法是按照两次渲染输出的 VDOM 按照 React 官方的 Diff 算法来得出不同，再在前端部署一个<code>react-dom</code>进行渲染的。结果发现这个方法过于复杂，前端运行时再带上<code>react-dom</code>就太重了，并不符合轻量级博客的定位。</p>
<p>于是我想到，博客几乎全是静态网页的文章，现在为止也就是目录导航之类的轻交互内容，何不直接替换<code>body</code>标签内容呢？能解决问题的方法就是好方法，更何况这只在开发阶段才会用，正式上线是没有 HMR 的。于是按照这个思路，后端只需要对比前后 body 标签内容是否变更即可，随后将 body 的内容发送至前端，前端对其直接替换。所以 HTML 的代码大约是：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22reloadHTML%22%5D,%22(%22,%5B%22parameterName%22,%22content%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">reloadHTML</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22content%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">content</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22localName%22,%22HTMLBodyElement%22%5D%5D">element</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-variable-dom" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22document%22%5D,%22:%20%22,%5B%22localName%22,%22Document%22%5D%5D">document</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ParentNode%22%5D,%22.%22,%5B%22methodName%22,%22querySelector%22%5D,%22%3C%22,%5B%22stringLiteral%22,%22%5C%22body%5C%22%22%5D,%22%3E(%22,%5B%22parameterName%22,%22selectors%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22body%5C%22%22%5D,%22):%20%22,%5B%22localName%22,%22HTMLBodyElement%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%224%22%5D,%22%20overloads)%22%5D">querySelector</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single">body</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22localName%22,%22HTMLBodyElement%22%5D%5D">element</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22localName%22,%22HTMLBodyElement%22%5D%5D">element</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-property" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22Element%22%5D,%22.%22,%5B%22propertyName%22,%22innerHTML%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">innerHTML</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22content%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">content</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>但是，<em>这还没完</em>。这么直接替换，页面元素看起来都被更新了，但是有交互的页面元素<em>并未从内存中卸载</em>，并且新呈现的元素没有经过各种交互的初始化，它们是没有交互动作的。这里就牵扯到 JS 的更新了，请看下一节。</p>
<h2 id="js%20%e6%9b%b4%e6%96%b0"><a class="post-anchor" href="#js%20%e6%9b%b4%e6%96%b0">§</a>JS 更新</h2>
<p>JS 模块的更新麻烦的部分有两个，其一是网页端加载 JS 的机制问题，另外则是 JS 内存回收的问题。</p>
<p>第一点很好理解，浏览器加载 JS 和 CSS 是不同的，CSS 每次添加个新的<code>link</code>元素，网页都会重新读取并加载；而 JS 不同，只要<code>script</code>的<code>src</code>内指向的地址不变，网页是不会运行第二遍的，所以这里就需要前端把代码手动运行一遍。这个很好做，只需要使用<code>(0, eval)(code)</code>就可以实时运行了。</p>
<p>第二点的问题主要是，JS 运行是有有很多状态量存在内存中的，所以每次更新都必须要先将这些状态清空，保证这部分内存被回收，然后重新加载模块时，再次进行初始化，生成新的状态量。所以这里我设计了全局的<code>Module</code>类，由它来统一调度所有的脚本模块，每个脚本模块都必须含有<em>装载</em>（<code>install</code>）和<em>卸载</em>（<code>uninstall</code>），它们的类型是这样的：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="">31</li><li class="">32</li><li class="">33</li><li class="">34</li><li class="">35</li><li class="">36</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">37</li><li class="">38</li><li class="">39</li><li class="">40</li><li class="">41</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 卸载函数 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-type-declaration lsp-storage-type-type">type</span> <span class="lsp-meta-type-declaration lsp-entity-name-type-alias" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22unActive%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20()%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">unActive</span> <span class="lsp-meta-type-declaration lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-type-declaration lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-type-declaration lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-type-declaration lsp-meta-type-function-return lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-type-declaration lsp-meta-type-function-return lsp-support-type-primitive">void</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 脚本模块 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D%5D">ScriptModule</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-meta-interface lsp-comment-block-documentation"> 当前模块地址 </span><span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22.%22,%5B%22propertyName%22,%22currentScript%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">currentScript</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span> <span class="lsp-meta-interface lsp-comment-block-documentation">* 启动模块</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span> <span class="lsp-meta-interface lsp-comment-block-documentation">*  - 返回卸载模块函数</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span> <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22.%22,%5B%22methodName%22,%22active%22%5D,%22():%20%22,%5B%22aliasName%22,%22unActive%22%5D%5D">active</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22unActive%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20()%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">unActive</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-meta-interface lsp-comment-block-documentation"> 是否重载整个脚本 </span><span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22.%22,%5B%22methodName%22,%22shouldReload%22%5D,%22?():%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">shouldReload</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-keyword-operator-optional" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22.%22,%5B%22methodName%22,%22shouldReload%22%5D,%22?():%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">?</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">boolean</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 模块装载器 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D%5D">ModuleLoader</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-meta-interface lsp-comment-block-documentation"> 安装模块 </span><span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D,%22.%22,%5B%22methodName%22,%22install%22%5D,%22(%22,%5B%22parameterName%22,%22module%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">install</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22module%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D%5D">module</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D%5D">ScriptModule</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-meta-interface lsp-comment-block-documentation"> 卸载模块 </span><span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D,%22.%22,%5B%22methodName%22,%22uninstall%22%5D,%22(%22,%5B%22parameterName%22,%22src%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">uninstall</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22src%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">src</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-keyword-operator-optional" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22src%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">?</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-meta-interface lsp-comment-block-documentation"> 重载模块 </span><span class="lsp-meta-interface lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D,%22.%22,%5B%22methodName%22,%22reload%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">reload</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 全局装载器 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22Module%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D%5D">Module</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D%5D">ModuleLoader</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 当前模块装载函数 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22active%22%5D,%22:%20()%20=%3E%20%22,%5B%22aliasName%22,%22unActive%22%5D%5D">active</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function-return lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-function-return lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22unActive%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20()%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">unActive</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 获取当前脚本地址 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-function lsp-storage-modifier">declare</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22getCurrentScriptSrc%22%5D,%22():%20%22,%5B%22keyword%22,%22string%22%5D%5D">getCurrentScriptSrc</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-function lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-return-type lsp-support-type-primitive">string</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 模块注册</span></li><li class=""><span class="lsp-keyword-control-conditional">if</span> <span class="lsp-meta-brace-round">(</span><span class="lsp-support-variable-object-process lsp-error-token" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">process</span><span class="lsp-punctuation-accessor">.</span><span class="lsp-support-variable-property-process" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">env</span><span class="lsp-punctuation-accessor">.</span><span class="lsp-variable-other-constant-property" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">NODE_ENV</span> <span class="lsp-keyword-operator-comparison">===</span> <span class="lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-string-quoted-single">development</span><span class="lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-brace-round">)</span> <span class="lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2591" title="点击查看错误详细信息">[TS2591]</a> Cannot find name 'process'. Do you need to install type definitions for node? Try `npm i --save-dev @types/node` and then add 'node' to the types field in your tsconfig.</li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22Module%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D%5D">Module</span><span class="lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ModuleLoader%22%5D,%22.%22,%5B%22methodName%22,%22install%22%5D,%22(%22,%5B%22parameterName%22,%22module%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">install</span><span class="lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22.%22,%5B%22propertyName%22,%22currentScript%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">currentScript</span><span class="lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22getCurrentScriptSrc%22%5D,%22():%20%22,%5B%22keyword%22,%22string%22%5D%5D">getCurrentScriptSrc</span><span class="lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-brace-round">(</span><span class="lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-variable-other-readwrite" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22ScriptModule%22%5D,%22.%22,%5B%22methodName%22,%22active%22%5D,%22():%20%22,%5B%22aliasName%22,%22unActive%22%5D%5D">active</span><span class="lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>在调试模式下，每个模块都必须将自己注册到全局的<code>Module</code>类中，<code>active</code>初始化函数将会返回卸载函数，这个卸载函数由每个模块自己控制，它必须保证其中的状态量都被安全卸载。这样下来每次更新 JS 模块时，首先需要将相同路径的模块全部卸载，然后再装载新的模块代码。</p>
<p>上文提到在更新 HTML 时，也需要更新模块，和直接更新 JS 代码不同，更新 HTML 时，由于 JS 代码并未变更，所以这里只需要将当前页面的模块重新装载，更新状态量即可。</p>
<h1 id="%e6%80%bb%e7%bb%93"><a class="post-anchor" href="#%e6%80%bb%e7%bb%93">§</a>总结</h1>
<p>不管细节怎么变化，HMR 的基本原理是相同的，都是监听文件变化并通过 WebSocket 发送变更数据；然后需要浏览器端提供对应的更新方法，细节上的差异主要都是在浏览器端如何更新页面元素上了。整体看下来，其实也并不复杂。</p></article></section><aside class="to-content"><header class="menu-list-header">目录</header><article class="menu-list-article"><ul class="menu-list"><li class="menu-item menu-level1"><a href="#%e6%a6%82%e8%bf%b0"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>概述</a></li><li class="menu-item menu-level1"><a href="#%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>基本原理</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84">代码结构</a></li><li class="menu-item menu-level2"><a href="#websocket%20%e6%9c%8d%e5%8a%a1">WebSocket 服务</a></li><li class="menu-item menu-level2"><a href="#%e5%a4%84%e7%90%86%e6%96%87%e4%bb%b6%e5%8f%98%e6%9b%b4">处理文件变更</a></li><li class="menu-item menu-level2"><a href="#%e6%b3%a8%e5%85%a5%e6%b5%8f%e8%a7%88%e5%99%a8%e7%ab%af%e8%bf%90%e8%a1%8c%e6%97%b6">注入浏览器端运行时</a></li></ul></li><li class="menu-item menu-level1"><a href="#%e5%89%8d%e7%ab%af%e6%9b%b4%e6%96%b0%e6%b5%81%e7%a8%8b"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>前端更新流程</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#css%20%e6%9b%b4%e6%96%b0">CSS 更新</a></li><li class="menu-item menu-level2"><a href="#html%20%e6%9b%b4%e6%96%b0">HTML 更新</a></li><li class="menu-item menu-level2"><a href="#js%20%e6%9b%b4%e6%96%b0">JS 更新</a></li></ul></li><li class="menu-item menu-level1"><a href="#%e6%80%bb%e7%bb%93"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>总结</a></li></ul></article></aside></div></article><footer class="main-footer"><span>Powered by </span><a href="https://github.com/xiaoboost" class="main-footer-href">Xiao</a><span> &amp; </span><a href="https://pages.github.com/" class="main-footer-href">Github Pages</a><span style="font-size:110%"> © </span><span>Since 2020</span></footer><div class="goto-top"><button class="goto-top-btn"><svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button></div><div data-width="8" data-mode="y" class="scrollbar invisible"><div class="slider"></div></div><script type="text/javascript" src="/scripts/layout.a1cf0ac821123b4e55217ecaae515f88.js"></script><script type="text/javascript" src="/scripts/post.3a108c44d494dcfb1ab471f7db3d5348.js"></script></body></html>