<!DOCTYPE html><html lang="zh-cmn-Hans-CN"><head><title>函数式风格的 DI 系统设计</title><meta name="charset" content="utf-8"/><meta name="author" content="xiao"/><meta name="description" content="尝试为 React 设计一个纯函数式的依赖注入系统，实现零装饰器依赖、作用域隔离、类型安全等特性。这是一个探索性项目，旨在验证函数式插件化在 DI 中的应用可能性，而非生产就绪的框架。"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="renderer" content="webkit"/><meta name="force-rendering" content="webkit"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><link rel="short icon" href="/images/favicon.d49166d79effe7141443cbb12866f5f5.ico"/><link rel="stylesheet" type="text/css" href="/styles/layout.afccee51719742708660d2a47ce938d1.css"/><link rel="stylesheet" type="text/css" href="/styles/post.d2fab5f40a24b2db660d67aa072ececb.css"/><link rel="stylesheet" type="text/css" href="/posts/2025/han2-shu4-shi4-feng1-ge2-de0-di-xi4-tong3-she4-ji4/styles/heading.e7b2228c5980612e73247cb88ba9981b.css"/></head><body><header class="main-header-wrapper"><span class="main-header"><a class="main-title" href="/">Dreaming Cat&#x27;s</a><nav class="main-nav"><a href="/" class="main-nav-item">首页</a><a href="/tags/" class="main-nav-item">标签</a><a href="/archive/" class="main-nav-item">归档</a><a href="/posts/about/" class="main-nav-item">关于</a></nav></span></header><article class="main-article-wrapper"><div class="main-article"><section class="post-default"><header class="post-header"><h1 class="post-header-title">函数式风格的 DI 系统设计</h1><time class="post-header-create">2025-11-22</time></header><article class="post-article">
<!-- -->
<!-- -->
<h1 id="%e5%bc%95%e8%a8%80%e4%b8%8e%e8%83%8c%e6%99%af"><a class="post-anchor" href="#%e5%bc%95%e8%a8%80%e4%b8%8e%e8%83%8c%e6%99%af">§</a>引言与背景</h1>
<h2 id="%e4%b8%ba%e4%bb%80%e4%b9%88%e5%81%9a%e8%bf%99%e4%b8%aa%e5%ae%9e%e9%aa%8c"><a class="post-anchor" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%81%9a%e8%bf%99%e4%b8%aa%e5%ae%9e%e9%aa%8c">§</a>为什么做这个实验</h2>
<p>在 React 项目中，<em>依赖注入 (Dependency Injection / DI)</em> 常常被忽略。组件通过<code>props</code>传递依赖，或通过<code>Context</code>共享状态，但缺少统一的依赖管理机制。随着项目复杂度上升，模块间耦合增加，测试变难，可维护性下降。<br/><span class="post-soft-break"></span>主流<em>DI</em>库（如<code>InversifyJS</code>、<code>TSyringe</code>）多采用<em>Class 模式</em>和<em>装饰器</em>，与 React 的函数式风格不一致。它们功能强大，但在 React 生态中显得“重”，且需要额外配置。<br/><span class="post-soft-break"></span>正是在这样的背景下，我在开发我自己的开源项目<a target="_blank" rel="noreferrer" href="https://github.com/xiaoboost/circuit-simulator/tree/feat/update"><em>Circuit Simulator</em></a>时遇到了具体的需求。这个项目需要一套插件化的架构，让各个功能模块可以独立开发和注册，同时还要支持多个画布实例的隔离。现有的 DI 方案要么太重，要么功能不足，无法满足需求。具体来说，我需要：</p>
<ol>
<li>插件化架构，各模块可独立注册与卸载</li>
<li>作用域隔离，不同画布实例互不干扰</li>
<li>类型安全，编译期检查依赖关系</li>
<li>与 React 深度集成，使用 Hooks 访问服务</li>
</ol>
<p>因此，我决定尝试一个更贴合 React 的函数式插件化 DI 系统，作为一次技术探索。</p>
<h2 id="%e4%b8%ba%e4%bb%80%e4%b9%88%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8%e7%8e%b0%e6%88%90%e7%9a%84%e6%96%b9%e6%a1%88"><a class="post-anchor" href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8%e7%8e%b0%e6%88%90%e7%9a%84%e6%96%b9%e6%a1%88">§</a>为什么没有使用现成的方案</h2>
<p>在开始设计之前，我调研了现有的 DI 库，发现主流 DI 库都采用 Class 模式和装饰器模式，但这种方式在 React 生态中存在一些问题，比如说装饰器实现复杂且版本差异大，与函数式风格不一致等。因此，我决定尝试设计一个全新的方案，探索函数式风格插件化在 DI 中的应用。这不是为了重复造轮子，而是想验证一种不同的可能性。<br/><span class="post-soft-break"></span>既然要设计新方案，首先要明确设计方向。主流 DI 库普遍采用 Class 模式和装饰器，但这种方式在 React 生态中存在一些问题。接下来，我想详细分析一下 Class 模式与装饰器的“重”，以及为什么选择函数式作为替代方案。</p>
<h3 id="class%20%e6%a8%a1%e5%bc%8f%e4%b8%8e%e8%a3%85%e9%a5%b0%e5%99%a8%e7%9a%84%e2%80%9c%e9%87%8d%e2%80%9d"><a class="post-anchor" href="#class%20%e6%a8%a1%e5%bc%8f%e4%b8%8e%e8%a3%85%e9%a5%b0%e5%99%a8%e7%9a%84%e2%80%9c%e9%87%8d%e2%80%9d">§</a>Class 模式与装饰器的“重”</h3>
<p>Class 模式与装饰器在 DI 中常见，但存在一些“重”的问题：</p>
<ol>
<li>装饰器实现复杂且版本差异大：装饰器提案历经多个阶段，不同版本实现差异明显。虽然现在已稳定，但若 DI 基座与插件使用不同装饰器版本，可能产生兼容性问题。不同库的装饰器实现也可能不兼容。</li>
<li>依赖自定义<code>Transformer</code>增加调试难度：部分 DI 系统依赖自定义的代码转换器将装饰器转为目标代码。这会让调试变难，源码与运行代码不一致，堆栈信息不直观，错误定位困难。</li>
<li>元数据与反射的开销：装饰器需要元数据支持，运行时反射机制带来额外开销。编译配置更复杂，需要启用实验性特性。</li>
<li>与函数式风格不一致：React 以函数式组件为主，Class 模式显得格格不入。需要额外的编译配置和学习成本。</li>
</ol>
<p>因此，我想设计一套纯函数式的 DI 系统，不依赖 Class 和装饰器，在保持良好开发体验的同时，降低技术实现复杂度。</p>
<h2 id="%e9%a1%b9%e7%9b%ae%e5%ae%9a%e4%bd%8d%e4%b8%8e%e8%ae%be%e8%ae%a1%e7%9b%ae%e6%a0%87"><a class="post-anchor" href="#%e9%a1%b9%e7%9b%ae%e5%ae%9a%e4%bd%8d%e4%b8%8e%e8%ae%be%e8%ae%a1%e7%9b%ae%e6%a0%87">§</a>项目定位与设计目标</h2>
<p>首先要说明的式，本文介绍的是一个实验性的 DI 系统实现，它是我在自己的开源项目 Circuit Simulator 中的一次技术探索。</p>
<ul>
<li>✅ 是一个学习与实验项目，用于探索不同的 DI 设计思路</li>
<li>✅ 在 Circuit Simulator 中实际使用，验证了设计可行性</li>
<li>❌ 不是一个生产就绪的成熟框架</li>
<li>❌ 不建议直接用于大型生产环境</li>
</ul>
<p>本文旨在分享设计思路与实践经验，探讨函数式插件化在 DI 中的应用，提供一种不同的技术视角，而非推广一个成熟框架。<br/><span class="post-soft-break"></span>如果你正在寻找生产级的 DI 解决方案，建议考虑<code>InversifyJS</code>、<code>TSyringe</code>等成熟库。如果你对不同的设计思路感兴趣，欢迎继续阅读。</p>
<h3 id="%e7%ba%af%e5%87%bd%e6%95%b0%e5%bc%8f%e9%a3%8e%e6%a0%bc%e5%ae%9e%e7%8e%b0%ef%bc%8c%e9%9b%b6%e8%a3%85%e9%a5%b0%e5%99%a8%e4%be%9d%e8%b5%96"><a class="post-anchor" href="#%e7%ba%af%e5%87%bd%e6%95%b0%e5%bc%8f%e9%a3%8e%e6%a0%bc%e5%ae%9e%e7%8e%b0%ef%bc%8c%e9%9b%b6%e8%a3%85%e9%a5%b0%e5%99%a8%e4%be%9d%e8%b5%96">§</a>纯函数式风格实现，零装饰器依赖</h3>
<p>采用纯函数式风格插件，不依赖 Class 和装饰器，并且函数式的风格更符合 React 的函数式风格，也更灵活。每个插件是一个函数，接收注册上下文，可以注册服务、钩子，并返回卸载函数。这样避免了装饰器版本差异和<code>Transformer</code>带来的调试问题，实现更简单、调试更直观。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 服务键 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 纯函数式插件，无需装饰器</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">getService</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 注册服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%7B%7D)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 返回卸载函数</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> ..</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h3 id="%e7%b2%be%e7%a1%ae%e4%b8%94%e5%ae%89%e5%85%a8%e7%9a%84%e7%b1%bb%e5%9e%8b%e6%8e%a8%e5%af%bc"><a class="post-anchor" href="#%e7%b2%be%e7%a1%ae%e4%b8%94%e5%ae%89%e5%85%a8%e7%9a%84%e7%b1%bb%e5%9e%8b%e6%8e%a8%e5%af%bc">§</a>精确且安全的类型推导</h3>
<p>插件可以注册任意对象（字面量、实例、函数等），不强制使用 Class。并且使用<code>Symbol</code>实现服务键的实现和类型包装，服务键不仅用于运行时查找，还能在编译期推导服务类型，避免类型错误。</p>
<p><code>definePlugin</code>的设计参考了<code>webpack</code>、<code>vite</code>等构建工具的配置函数模式。这种设计的优势在于，通过函数参数，TypeScript 可以精确推导出上下文类型，无需维护一个包含所有可能方法的巨大接口。同时，这种设计实现了按需暴露 API，只暴露插件实际需要的 API，而不是一个臃肿的上下文对象。更重要的是，类型定义更简洁，不需要定义包含所有可能方法的接口，类型系统自动处理，让代码更加简洁易读。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="lsp-error-start-line"> </li><li class="lsp-error-end-line"> </li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 服务类型定义</span></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D%5D">ILoggerService</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22info%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">info</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22error%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">error</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建类型安全的服务键</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E%22%5D">ILoggerService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D%5D">ILoggerService</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">ILoggerService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 插件函数接收上下文，TypeScript 自动推导类型</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D%5D">context</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 注册服务时可以提供精确的自动补全</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 这里会报错说少了 error 方法</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D%5D">context</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22.%22,%5B%22methodName%22,%22registerService%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E%22%5D">ILoggerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block lsp-error-token">{</span></li><li class="lsp-error lsp-error-start-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2345" title="点击查看错误详细信息">[TS2345]</a> Argument of type '{ info(msg: string): void; }' is not assignable to parameter of type 'ILoggerService'.</li><li class="lsp-error lsp-error-end-line">  Property 'error' is missing in type '{ info(msg: string): void; }' but required in type 'ILoggerService'.</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-comment-line-double-slash"> 精确的自动补全和类型检查</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22info%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">info</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22msg%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">msg</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash"> ..</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 安全的类型推导</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22storageService%22%5D,%22:%20%22,%5B%22localName%22,%22ILoggerService%22%5D%5D">storageService</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D%5D">context</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D,%22.%22,%5B%22methodName%22,%22getService%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E):%20%22,%5B%22localName%22,%22ILoggerService%22%5D%5D">getService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E%22%5D">ILoggerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h3 id="%e9%99%8d%e4%bd%8e%e6%8a%80%e6%9c%af%e5%a4%8d%e6%9d%82%e5%ba%a6%ef%bc%8c%e4%bf%9d%e6%8c%81%e5%bc%80%e5%8f%91%e4%bd%93%e9%aa%8c"><a class="post-anchor" href="#%e9%99%8d%e4%bd%8e%e6%8a%80%e6%9c%af%e5%a4%8d%e6%9d%82%e5%ba%a6%ef%bc%8c%e4%bf%9d%e6%8c%81%e5%bc%80%e5%8f%91%e4%bd%93%e9%aa%8c">§</a>降低技术复杂度，保持开发体验</h3>
<p>这是与 Class 模式相比的主要优势。系统无需配置装饰器或<code>transformer</code>，也无需启用实验性特性，开箱即用。调试时源码与运行代码一致，堆栈信息清晰，错误定位更容易。同时，系统保持了类型安全和良好的开发体验，TypeScript 可以提供准确的类型检查和自动补全，让开发更加高效。</p>
<h3 id="%e4%bd%9c%e7%94%a8%e5%9f%9f%e9%9a%94%e7%a6%bb%e6%9c%ba%e5%88%b6"><a class="post-anchor" href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e9%9a%94%e7%a6%bb%e6%9c%ba%e5%88%b6">§</a>作用域隔离机制</h3>
<p>支持多级作用域，每个作用域有独立的服务容器。子作用域可访问父作用域的服务，但钩子只在当前作用域生效。这样可以在不同画布实例间实现隔离，同时共享全局服务。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D%5D">createPluginDefinitionWithScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建作用域</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">Painter</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在作用域中注册插件</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22definePainterPlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">definePainterPlugin</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D%5D">createPluginDefinitionWithScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h3 id="%e9%98%b2%e6%ad%a2%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96"><a class="post-anchor" href="#%e9%98%b2%e6%ad%a2%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96">§</a>防止循环依赖</h3>
<p>在插件注册阶段禁止访问服务，强制延迟访问。通过<code>getServices</code>的延迟访问机制，可以在生命周期钩子中安全地使用服务，避免循环依赖问题。</p>
<h3 id="react%20%e6%b7%b1%e5%ba%a6%e9%9b%86%e6%88%90"><a class="post-anchor" href="#react%20%e6%b7%b1%e5%ba%a6%e9%9b%86%e6%88%90">§</a>React 深度集成</h3>
<p>提供 React Hooks API，让组件可以方便地访问服务。同时支持生命周期钩子，与 React 组件的生命周期对齐。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useService%22%5D%5D">useService</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D%5D">useHook</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useLifeCycle%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useLifeCycle%22%5D%5D">useLifeCycle</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 流服务键 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%3E%22%5D">IStreamService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">event</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">any</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IStreamService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 事件监听钩子键 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E%22%5D">IEventListenerHook</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">event</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-definition-property lsp-entity-name-function" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handler</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">data</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">any</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function-return lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-function-return lsp-support-type-primitive">void</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IEventListenerHook</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Component%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">Component</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22streamService%22%5D,%22:%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%22%5D">streamService</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useService%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%3E):%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useService%22%5D%5D">useService</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%7D%3E%22%5D">IStreamService</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hooks%22%5D,%22:%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%5B%5D%22%5D">hooks</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useHook%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D%5D">useHook</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22event%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22handler%22%5D,%22:%20(%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E%22%5D">IEventListenerHook</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single">asc</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22lifeCycle%22%5D,%22:%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%22%5D">lifeCycle</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useLifeCycle%22%5D,%22():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useLifeCycle%22%5D%5D">useLifeCycle</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<h3 id="%e8%ae%be%e8%ae%a1%e7%9a%84%e8%be%b9%e7%95%8c"><a class="post-anchor" href="#%e8%ae%be%e8%ae%a1%e7%9a%84%e8%be%b9%e7%95%8c">§</a>设计的边界</h3>
<p>在开始之前，我也明确了一些边界，这些边界帮助我聚焦核心问题，避免过度设计：</p>
<ul>
<li>不追求功能完整性：专注于核心功能，不实现所有可能的特性</li>
<li>不追求性能极致：优先保证正确性和可维护性</li>
<li>不追求通用性：针对 React 生态优化，不考虑其他框架</li>
<li>不追求完美：允许不完美，重点是探索和学习</li>
</ul>
<p>接下来，就让我们开始吧——</p>
<h1 id="%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5"><a class="post-anchor" href="#%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5">§</a>核心概念</h1>
<h2 id="%e6%8f%92%e4%bb%b6%e7%b3%bb%e7%bb%9f"><a class="post-anchor" href="#%e6%8f%92%e4%bb%b6%e7%b3%bb%e7%bb%9f">§</a>插件系统</h2>
<p>插件是函数，接收注册上下文，可以注册服务、钩子，并返回卸载函数。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D%5D">IService</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IService%22%5D,%22.%22,%5B%22methodName%22,%22cleanup%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">cleanup</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IService%22%5D,%22%3E%22%5D">IService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22localName%22,%22IService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D%5D">IService</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IHook</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IHook</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D%5D">context</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D%5D">IService</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-control-as">as</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-support-type-primitive">any</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 注册服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D%5D">context</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22.%22,%5B%22methodName%22,%22registerService%22%5D,%22%3C%22,%5B%22localName%22,%22IService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IService%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IService%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IService%22%5D,%22%3E%22%5D">IService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 注册钩子</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IPluginInstallerContext%22%5D%5D">context</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22.%22,%5B%22methodName%22,%22registerHook%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%7B%7D):%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 返回卸载函数（可选）</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 清理逻辑</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IService%22%5D,%22.%22,%5B%22methodName%22,%22cleanup%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">cleanup</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>这个插件系统的特点是：</p>
<ul>
<li>函数式风格：插件是纯函数，不依赖 Class 或装饰器</li>
<li>延迟执行：插件在<code>useInjectInstall</code>调用时才执行</li>
<li>生命周期：插件可以返回卸载函数，在组件卸载时自动调用</li>
<li>作用域绑定：每个插件绑定到特定作用域</li>
<li>跨作用域访问：通过<code>parent()</code>和<code>root()</code>方法可以访问父作用域或根作用域</li>
</ul>
<h2 id="%e6%9c%8d%e5%8a%a1%e4%b8%8e%e9%92%a9%e5%ad%90"><a class="post-anchor" href="#%e6%9c%8d%e5%8a%a1%e4%b8%8e%e9%92%a9%e5%ad%90">§</a>服务与钩子</h2>
<p>系统中有两种注册类型：<em>服务 Service</em>和<em>钩子 Hook</em>。</p>
<p>服务是<em>单例</em>，每个服务键对应一个实例。注册时会覆盖之前的实例，确保同一键只有一个服务。适合提供核心功能，如配置服务、存储服务等。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="code-block-highlight-line">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="code-block-highlight-line">17</li><li class="">18</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">IStreamService</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">key</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">any</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22clear%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">clear</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建服务键</span></li><li class="code-block-highlight-line"><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%22%5D">IStreamService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">IStreamService</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IStreamService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 注册服务</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">IStreamService</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">key</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">/*</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block"> ... </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">*/</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22clear%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">clear</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">/*</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block"> ... </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">*/</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class="code-block-highlight-line"><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%22%5D">IStreamService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>钩子是<em>集合</em>，每个钩子键可对应多个实例。多个插件可注册到同一个钩子键，系统会收集所有实例。适合扩展点模式，如事件监听钩子、生命周期钩子、渲染器等。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject/IEventListenerHook</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 多个插件可以注册到同一个钩子键</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseDown%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onMouseDown</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">/*</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-comment-block"> ... </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">*/</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseUp%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onMouseUp</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">/*</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-comment-block"> ... </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">*/</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>这种设计让服务适合提供核心功能，钩子适合扩展点模式。</p>
<h2 id="%e4%bd%9c%e7%94%a8%e5%9f%9f"><a class="post-anchor" href="#%e4%bd%9c%e7%94%a8%e5%9f%9f">§</a>作用域</h2>
<p>系统支持多级作用域，形成作用域树。每个作用域有独立的服务容器和钩子容器。<br/><span class="post-soft-break"></span>在复杂应用中，不同模块可能需要不同的服务实例。例如，多个画布实例需要独立的状态管理，不同上下文需要不同的服务，测试时需要独立的服务容器。如果没有作用域，所有服务都在全局共享，无法隔离的话很容易出现难以排查的问题。</p>
<p>作用域创建子作用域：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建根作用域（系统内置）</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22localName%22,%22RootScope%22%5D%5D">RootScope</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Symbol%22%5D,%22:%20%22,%5B%22interfaceName%22,%22SymbolConstructor%22%5D,%22%5Cn(%22,%5B%22parameterName%22,%22description%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">Symbol</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">RootScope</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建子作用域</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">Painter</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22localName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22EditorScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">EditorScope</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">Editor</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>作用域树结构如下：</p>
<pre class="code-block-wrapper"><label class="code-block-label">Bash</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li></ul><span class="code-block-box"><ul class="code-block-code"><li class="">RootScope</li><li class=""><span class="code-block-split"></span>  └─── PainterScope</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  ├── EditorScope</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  └── ViewerScope</li></ul></span></code></pre>
<h3 id="%e6%9c%8d%e5%8a%a1%e6%9f%a5%e6%89%be%e7%ad%96%e7%95%a5"><a class="post-anchor" href="#%e6%9c%8d%e5%8a%a1%e6%9f%a5%e6%89%be%e7%ad%96%e7%95%a5">§</a>服务查找策略</h3>
<p>服务查找策略采用了<em>向上查找</em>的策略。从当前作用域开始，如果找不到，会向上查找父作用域，直到根作用域。这样子作用域可以访问父作用域的服务，实现服务共享。但父作用域无法访问子作用域的服务，这样保证隔离，也符合编程的直觉。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="code-block-highlight-line">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="code-block-highlight-line">31</li><li class="">32</li><li class="">33</li><li class="">34</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D%5D">defineGlobalPlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D%5D">defineChildPlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D%5D">ILifeCycleHook</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject/ILifeCycleHook</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 根作用域服务键 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IGlobalService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IGlobalService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IGlobalService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IChildService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IChildService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IChildService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在根作用域注册服务</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D%5D">defineGlobalPlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">getService</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 在根作用域注册服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%7B%7D)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IGlobalService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IGlobalService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 在生命周期中访问父级作用于服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D%5D">ILifeCycleHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILifeCycleHook%22%5D,%22.%22,%5B%22methodName%22,%22onMounted%22%5D,%22?():%20%22,%5B%22keyword%22,%22void%22%5D,%22%20%7C%20%22,%5B%22localName%22,%22Promise%22%5D,%22%3C%22,%5B%22keyword%22,%22void%22%5D,%22%3E%22%5D">onMounted</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class="code-block-highlight-line"><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%7B%7D%22%5D">service</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E)%20=%3E%20%7B%7D%22%5D">getService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IChildService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IChildService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash"> ❌ 找不到</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在子作用域使用根作用域注册的服务</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D%5D">defineChildPlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">getService</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 在子作用域注册服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%7B%7D)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IChildService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IChildService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 在生命周期中访问父级作用于服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILifeCycleHook%22%5D%5D">ILifeCycleHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILifeCycleHook%22%5D,%22.%22,%5B%22methodName%22,%22onMounted%22%5D,%22?():%20%22,%5B%22keyword%22,%22void%22%5D,%22%20%7C%20%22,%5B%22localName%22,%22Promise%22%5D,%22%3C%22,%5B%22keyword%22,%22void%22%5D,%22%3E%22%5D">onMounted</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class="code-block-highlight-line"><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%7B%7D%22%5D">service</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E)%20=%3E%20%7B%7D%22%5D">getService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IGlobalService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IGlobalService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash"> ✅ 可以找到</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>服务采用向上查找策略，主要有几个原因。首先，这样可以减少重复注册，全局服务只需在根作用域注册一次，所有子作用域都可以访问，避免了在每个子作用域都重复注册相同的服务。其次，这种策略能够节约资源，避免为每个作用域创建重复的服务实例，特别是对于那些无状态或可以共享的服务来说，这种方式更加高效。同时，这种设计还提供了灵活性，可以在不同层级提供不同的服务实现，子作用域优先使用自己的服务，如果找不到再向上查找，这样既支持了服务共享，又允许在特定作用域中覆盖服务实现。最后，这种单向继承的设计保证了隔离性，父作用域无法访问子作用域的服务，确保了作用域之间的隔离，避免了意外的服务访问。额外的是，这种设计比较符合一般意义上的编程直觉。</p>
<h3 id="%e9%92%a9%e5%ad%90%e9%9a%94%e7%a6%bb%e7%ad%96%e7%95%a5"><a class="post-anchor" href="#%e9%92%a9%e5%ad%90%e9%9a%94%e7%a6%bb%e7%ad%96%e7%95%a5">§</a>钩子隔离策略</h3>
<p>只在当前作用域查找。默认只在当前作用域查找。钩子不会向上查找，每个作用域只返回自己注册的钩子。这样不同作用域可以有独立的钩子集合，实现隔离。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D%5D">defineGlobalPlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D%5D">defineChildPlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D%5D">useHook</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject/IEventListenerHook</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在根作用域注册钩子</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineGlobalPlugin%22%5D%5D">defineGlobalPlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22rootHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">rootHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22rootHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">rootHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在子作用域注册钩子</span></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22defineChildPlugin%22%5D%5D">defineChildPlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22childHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">childHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22childHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">childHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在子作用域获取钩子，只会返回 childHook，不会包含 rootHook</span></li><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Component%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">Component</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">hooks</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useHook%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D%5D">useHook</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>如果需要注册父作用域的钩子，可以通过<code>parent()</code>或<code>root()</code>方法显式跨作用域注册。在<code>definePlugin</code> 的回调上下文中，提供了这两个方法。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject/IEventListenerHook</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parent%22%5D,%22:%20()%20=%3E%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22undefined%22%5D%5D">parent</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22root%22%5D,%22:%20()%20=%3E%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D%5D">root</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 可以在父作用域注册钩子</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parent%22%5D,%22:%20()%20=%3E%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22undefined%22%5D%5D">parent</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor-optional">?.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22.%22,%5B%22methodName%22,%22registerHook%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 也可以在根作用域注册钩子</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-support-variable-object-node" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22root%22%5D,%22:%20()%20=%3E%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D%5D">root</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22IPluginScopeRegister%22%5D,%22.%22,%5B%22methodName%22,%22registerHook%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">{</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>要访问父作用域的钩子，就比较麻烦了，需要拿到上级作用域的键本身，然后使用<code>withScope</code>系列的方法来实现，但是这种情况应该是极少的，钩子的设计本来就是可以跨作用域的注册，但是尽量不要跨作用域消费的，如果你需要跨作用域的消费钩子，那应该考虑这个钩子的设计是否合理。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22useHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHookWithScope%22%5D%5D">useHookWithScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IGlobalHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IGlobalHook</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IGlobalHook</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 在子作用域获取全局的钩子</span></li><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Component%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">Component</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hooks%22%5D,%22:%20%7B%7D%5B%5D%22%5D">hooks</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useHookWithScope%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%7B%7D%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHookWithScope%22%5D%5D">useHookWithScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IGlobalHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IGlobalHook</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>钩子采用隔离策略，主要是为了精确控制每个作用域的扩展点。每个作用域可以精确控制自己的钩子集合，不会受到其他作用域的影响。这种隔离设计还能避免污染，子作用域的钩子不会影响父作用域，确保了不同作用域之间的独立性。更重要的是，这种设计让不同作用域可以有完全不同的扩展集合，每个作用域都可以根据自己的需求注册不同的钩子，互不干扰。同时，系统也提供了灵活性，当确实需要注册父作用域的钩子时，可以通过<code>parent()</code>或<code>root()</code>方法显式跨作用域访问，这样既保证了默认的隔离性，又提供了必要的灵活性。</p>
<h2 id="%e7%b1%bb%e5%9e%8b%e5%ae%89%e5%85%a8%e8%ae%be%e8%ae%a1"><a class="post-anchor" href="#%e7%b1%bb%e5%9e%8b%e5%ae%89%e5%85%a8%e8%ae%be%e8%ae%a1">§</a>类型安全设计</h2>
<p>在传统的 DI 系统中，服务键通常是字符串或<code>Symbol</code>，这些标识符在运行时才能知道对应的服务类型。这会导致从容器获取的服务类型变成<code>any</code>，失去了类型信息。更严重的是，这种类型丢失会让编译期无法检查类型错误，只能在运行时才能发现问题。同时，IDE 也无法提供准确的自动补全，开发体验大打折扣。<br/><span class="post-soft-break"></span>因此，我们需要一种机制能够在编译期就能推导出服务类型，让 TypeScript 的类型系统能够帮助我们检查错误，提供更好的开发体验。</p>
<p>TypeScript 的<em>品牌类型 Branded Types</em>可以在运行时保持简单（使用<code>Symbol</code>），同时在编译期提供类型信息。<br/><span class="post-soft-break"></span>品牌类型的核心思想是：给一个基础类型添加一个类型标记，这个标记只在编译期存在，运行时会被擦除。这样既保持了运行时的简单性，又提供了编译期的类型安全。<br/><span class="post-soft-break"></span>通过品牌类型，服务键不仅是一个运行时标识，还能携带类型信息。TypeScript 可以从服务键推导出对应的服务类型，实现类型安全的依赖注入。<br/><span class="post-soft-break"></span>使用品牌类型后，系统可以获得编译期类型检查的能力。当使用服务时，TypeScript 可以检查类型是否正确，如果调用了不存在的方法或属性，会在编译期就报错，而不是等到运行时才发现问题。同时，系统还支持自动类型推导，不需要手动指定类型，TypeScript 会根据服务键自动推导出对应的服务类型。这种自动推导不仅减少了代码量，还让代码更加简洁易读。<br/><span class="post-soft-break"></span>更重要的是，这种类型推导带来了更好的 IDE 支持。IDE 可以提供准确的自动补全和类型提示，让开发者在编写代码时就能知道服务有哪些方法和属性，大大提升了开发效率。最后，这种类型安全还让重构变得更加友好。当修改服务接口时，TypeScript 可以检查所有使用处，确保修改不会破坏现有的代码，让重构变得更加安全和可靠。</p>
<p>使用示例：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="">31</li><li class="">32</li><li class="">33</li><li class="">34</li><li class="">35</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">36</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 定义服务接口</span></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">IStreamService</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">key</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">symbol</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">any</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22clear%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">clear</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建服务键，类型被&quot;品牌化&quot;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%22%5D">IStreamService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">IStreamService</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IStreamService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStorageService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IStorageService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IStorageService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IConfigurationService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IConfigurationService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IConfigurationService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">getService</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getServices%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22extends%22%5D,%22%20%22,%5B%22aliasName%22,%22Record%22%5D,%22%3C%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E%3E%3E(%22,%5B%22parameterName%22,%22services%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%7B%20%5B%22,%5B%22typeParameterName%22,%22K%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22keyword%22,%22keyof%22%5D,%22%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5D:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%22,%5B%22typeParameterName%22,%22K%22%5D,%22%5D%20%22,%5B%22keyword%22,%22extends%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22infer%22%5D,%22%20%22,%5B%22typeParameterName%22,%22U%22%5D,%22%3E%20?%20%22,%5B%22typeParameterName%22,%22U%22%5D,%22%20:%20%22,%5B%22keyword%22,%22never%22%5D,%22;%20%7D%22%5D">getServices</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 获取单个服务，TypeScript 自动推导类型</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">service</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getService%22%5D,%22:%20%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E)%20=%3E%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">getService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%22%5D">IStreamService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22unique%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">key</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Symbol%22%5D,%22:%20%22,%5B%22interfaceName%22,%22SymbolConstructor%22%5D,%22%5Cn(%22,%5B%22parameterName%22,%22description%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">Symbol</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single">key</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 类型安全</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22unique%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">key</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-support-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22clear%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">clear</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 类型错误：不存在此方法</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">service</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function lsp-error-token" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">unknown</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2339" title="点击查看错误详细信息">[TS2339]</a> Property 'unknown' does not exist on type 'IStreamService'.</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 批量获取服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22services%22%5D,%22:%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%7B%7D;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%7B%7D;%5Cn%7D%22%5D">services</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22getServices%22%5D,%22:%20%3C%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22services%22%5D,%22:%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E;%5Cn%7D)%20=%3E%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%7B%7D;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%7B%7D;%5Cn%7D%22%5D">getServices</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%22%5D">stream</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IStreamService%22%5D,%22%3E%22%5D">IStreamService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">storage</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IStorageService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IStorageService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">config</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IConfigurationService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%7D%3E%22%5D">IConfigurationService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22services%22%5D,%22:%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%7B%7D;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%7B%7D;%5Cn%7D%22%5D">services</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D%5D">stream</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22unique%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">key</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 类型错误：不存在此方法</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22services%22%5D,%22:%20%7B%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22stream%22%5D,%22:%20%22,%5B%22localName%22,%22IStreamService%22%5D,%22;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%7B%7D;%5Cn%20%20%20%20%22,%5B%22propertyName%22,%22config%22%5D,%22:%20%7B%7D;%5Cn%7D%22%5D">services</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22storage%22%5D,%22:%20%7B%7D%22%5D">storage</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-support-function-dom lsp-error-token" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-arrow lsp-meta-block lsp-string-quoted-single">key</span><span class="lsp-meta-arrow lsp-meta-block lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2339" title="点击查看错误详细信息">[TS2339]</a> Property 'get' does not exist on type '{}'.</li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h1 id="%e5%9f%ba%e7%a1%80%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b"><a class="post-anchor" href="#%e5%9f%ba%e7%a1%80%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b">§</a>基础使用示例</h1>
<h2 id="%e6%9c%8d%e5%8a%a1%e4%b8%8e%e9%92%a9%e5%ad%90"><a class="post-anchor" href="#%e6%9c%8d%e5%8a%a1%e4%b8%8e%e9%92%a9%e5%ad%90">§</a>服务与钩子</h2>
<p>服务和钩子其实注册方式都差不多，这里仅介绍服务，钩子的使用方式类似。</p>
<h3 id="%e5%88%9b%e5%bb%ba%e6%9c%8d%e5%8a%a1%e9%94%ae"><a class="post-anchor" href="#%e5%88%9b%e5%bb%ba%e6%9c%8d%e5%8a%a1%e9%94%ae">§</a>创建服务键</h3>
<p>首先，需要创建服务键。服务键是类型安全的标识符，用于标识和查找服务：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 定义服务接口</span></li><li class=""><span class="lsp-meta-interface lsp-keyword-control-export">export</span> <span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D%5D">ILoggerService</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22error%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">error</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建服务键</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E%22%5D">ILoggerService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22ILoggerService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22ILoggerService%22%5D%5D">ILoggerService</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">ILoggerService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h3 id="%e6%b3%a8%e5%86%8c%e6%9c%8d%e5%8a%a1"><a class="post-anchor" href="#%e6%b3%a8%e5%86%8c%e6%9c%8d%e5%8a%a1">§</a>注册服务</h3>
<p>通过<code>definePlugin</code>注册服务。插件是一个函数，接收注册上下文：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">ILoggerService</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject/ILoggerService</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 创建服务实例</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22loggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">loggerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">ILoggerService</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-support-class-console" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22console%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Console%22%5D%5D">console</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-support-function-console" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22Console%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(...%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template">[LOG] </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22error%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">error</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-support-class-console" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22console%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Console%22%5D%5D">console</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-support-function-console" ls-info="%5B%22(method)%20%22,%5B%22interfaceName%22,%22Console%22%5D,%22.%22,%5B%22methodName%22,%22error%22%5D,%22(...%22,%5B%22parameterName%22,%22data%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D):%20%22,%5B%22keyword%22,%22void%22%5D%5D">error</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template">[ERROR] </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">message</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-arrow lsp-meta-block lsp-comment-line-double-slash"> 注册服务</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">ILoggerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22loggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">loggerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h2 id="%e5%9c%a8%e7%bb%84%e4%bb%b6%e4%b8%ad%e4%bd%bf%e7%94%a8"><a class="post-anchor" href="#%e5%9c%a8%e7%bb%84%e4%bb%b6%e4%b8%ad%e4%bd%bf%e7%94%a8">§</a>在组件中使用</h2>
<p>在组件树的根部，需要创建<code>InjectContext.Provider</code>，并传入一个<code>Map</code>作为 DI 容器：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D%5D">InjectContext</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22React%22%5D%5D">React</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-error-token">react</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-keyword-control-exportx">export</span> <span class="lsp-sourcex lsp-meta-functionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22App%22%5D,%22():%20%22,%5B%22keyword%22,%22any%22%5D%5D">App</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx lsp-support-class-componentx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D%5D">InjectContext.Provider</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-entity-other-attribute-namex" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22value%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E%22%5D">value</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-keyword-operator-assignmentx">=</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-meta-embedded-expressionx lsp-new-exprx lsp-keyword-operator-newx">new</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-meta-embedded-expressionx lsp-new-exprx lsp-meta-function-callx lsp-support-class-builtinx" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22:%20%22,%5B%22interfaceName%22,%22MapConstructor%22%5D,%22%5Cn%22,%5B%22keyword%22,%22new%22%5D,%22%20()%20=%3E%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%223%22%5D,%22%20overloads)%22%5D">Map</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-meta-embedded-expressionx lsp-new-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-meta-embedded-expressionx lsp-new-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-punctuation-section-embedded-endx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx">App</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx lsp-support-class-componentx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D%5D">InjectContext.Provider</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<p>这个<code>Map</code>就是整个应用共享的 DI 容器，所有子组件都可以通过<code>Context</code>访问它。</p>
<p>然后在需要使用 DI 的组件中，首先调用<code>useInjectInstall</code>初始化 DI 系统，它会执行所有已注册的插件，初始化服务和钩子。返回的<code>pluginInitialized</code>表示插件是否已初始化完成。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22React%22%5D%5D">React</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-error-token">react</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22useInjectInstall%22%5D,%22():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5Bready:%20%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useInjectInstall%22%5D%5D">useInjectInstall</span><span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useServiceWithGlobal%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useServiceWithGlobal%22%5D%5D">useServiceWithGlobal</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Initialization%22%5D,%22():%20%22,%5B%22keyword%22,%22any%22%5D%5D">Initialization</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-array-binding-pattern-variablex lsp-punctuation-definition-binding-pattern-arrayx">[</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-array-binding-pattern-variablex lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22pluginInitialized%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">pluginInitialized</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-array-binding-pattern-variablex lsp-punctuation-definition-binding-pattern-arrayx">]</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useInjectInstall%22%5D,%22():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5Bready:%20%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useInjectInstall%22%5D%5D">useInjectInstall</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx"> 等待初始化完成</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-conditionalx">if</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-operator-logicalx">!</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22pluginInitialized%22%5D,%22:%20%22,%5B%22keyword%22,%22boolean%22%5D%5D">pluginInitialized</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-constant-language-nullx">null</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx"> 这里可以放你真正的 App 组件</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">/&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<p>初始化完成后，可以使用全局作用域的快捷方法获取服务：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22React%22%5D%5D">React</span><span class="lsp-sourcex lsp-meta-importx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useEffect%22%5D%5D">useEffect</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-error-token">react</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useServiceWithGlobal%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useServiceWithGlobal%22%5D%5D">useServiceWithGlobal</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">ILoggerService</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject/ILoggerService</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Layout%22%5D,%22():%20%22,%5B%22keyword%22,%22any%22%5D%5D">Layout</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22logger%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">logger</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useServiceWithGlobal%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E):%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useServiceWithGlobal%22%5D%5D">useServiceWithGlobal</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-readwritex" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22ILoggerService%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">ILoggerService</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useEffect%22%5D%5D">useEffect</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22logger%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">logger</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22ILoggerService%22%5D,%22.%22,%5B%22methodName%22,%22log%22%5D,%22(%22,%5B%22parameterName%22,%22message%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">log</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">组件已加载</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-meta-brace-squarex">[</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22logger%22%5D,%22:%20%22,%5B%22aliasName%22,%22ILoggerService%22%5D%5D">logger</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-meta-brace-squarex">]</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-meta-jsx-childrenx">Layout</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tag-without-attributesx lsp-punctuation-definition-tag-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<p>全局作用域提供了三个快捷方法：</p>
<ul>
<li><code>useServiceWithGlobal</code>：获取服务</li>
<li><code>useHookWithGlobal</code>：获取钩子</li>
<li><code>useLifeCycleWithGlobal</code>：管理生命周期</li>
</ul>
<p>这些方法会自动获取全局作用域的服务、钩子和生命周期，不需要手动传入作用域。</p>
<h2 id="%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%9a%84%e4%bd%bf%e7%94%a8"><a class="post-anchor" href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%9a%84%e4%bd%bf%e7%94%a8">§</a>作用域的使用</h2>
<h3 id="%e5%ae%9a%e4%b9%89%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%92%8c%e5%bf%ab%e6%8d%b7%e6%96%b9%e6%b3%95"><a class="post-anchor" href="#%e5%ae%9a%e4%b9%89%e4%bd%9c%e7%94%a8%e5%9f%9f%e5%92%8c%e5%bf%ab%e6%8d%b7%e6%96%b9%e6%b3%95">§</a>定义作用域和快捷方法</h3>
<p>在实际项目中，通常会为特定功能模块创建独立的作用域，并导出快捷方法。这样的话，在子作用域相关的代码中，就可以直接使用<code>useService</code>、<code>useHook</code>和<code>useLifeCycle</code>，而不需要每次都传入作用域参数。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="code-block-highlight-line">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="code-block-highlight-line">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> painter/context/index.ts</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D%5D">createPluginDefinitionWithScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D%5D">createReactHookWithScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 创建画布作用域</span></li><li class="code-block-highlight-line"><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D,%22(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createScopeSymbol%22%5D%5D">createScopeSymbol</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">Painter</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 为画布作用域创建快捷 Hooks</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22reactHook%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">reactHook</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D%5D">createReactHookWithScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 导出画布作用域的插件定义函数</span></li><li class="code-block-highlight-line"><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">definePlugin</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createPluginDefinitionWithScope%22%5D%5D">createPluginDefinitionWithScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22PainterScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">PainterScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-comment-line-double-slash"> 导出画布作用域的快捷方法</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22useService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">useService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22reactHook%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">reactHook</span><span class="lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-variable-other-property" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useService%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">useService</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22useHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">useHook</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22reactHook%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">reactHook</span><span class="lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-variable-other-property" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useHook%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">useHook</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22useLifeCycle%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%22%5D">useLifeCycle</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22reactHook%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">reactHook</span><span class="lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-variable-other-property" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useLifeCycle%22%5D,%22():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%22%5D">useLifeCycle</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h3 id="%e5%9c%a8%e4%bd%9c%e7%94%a8%e5%9f%9f%e4%b8%ad%e6%b3%a8%e5%86%8c%e6%8f%92%e4%bb%b6"><a class="post-anchor" href="#%e5%9c%a8%e4%bd%9c%e7%94%a8%e5%9f%9f%e4%b8%ad%e6%b3%a8%e5%86%8c%e6%8f%92%e4%bb%b6">§</a>在作用域中注册插件</h3>
<p>使用导出的<code>definePlugin</code>在子作用域中注册插件：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22:%20(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IPainterService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E%22%5D">IPainterService</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22getCanvas%22%5D,%22():%20%22,%5B%22keyword%22,%22any%22%5D%5D">getCanvas</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">any</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22render%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">render</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IPainterService</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22definePlugin%22%5D,%22(%22,%5B%22parameterName%22,%22installer%22%5D,%22:%20%22,%5B%22aliasName%22,%22PluginInstaller%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22definePlugin%22%5D%5D">definePlugin</span><span class="lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">{</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span> <span class="lsp-meta-arrow lsp-meta-parameters lsp-meta-parameter-object-binding-pattern lsp-punctuation-definition-binding-pattern-object">}</span><span class="lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22painterService%22%5D,%22:%20%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%22%5D">painterService</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22getCanvas%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">getCanvas</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">/*</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block"> ... </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">*/</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22render%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">render</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">/*</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block"> ... </span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-block lsp-punctuation-definition-comment">*/</span> <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22registerService%22%5D,%22:%20%3C%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E,%20%22,%5B%22parameterName%22,%22service%22%5D,%22:%20%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">registerService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IPainterService%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%3E%22%5D">IPainterService</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22painterService%22%5D,%22:%20%7B%5Cn%20%20%20%20getCanvas():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%20%20%20%20render():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%22%5D">painterService</span><span class="lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h2 id="%e8%bf%9e%e6%8e%a5%e7%bb%84%e4%bb%b6%e4%b8%8e%20di"><a class="post-anchor" href="#%e8%bf%9e%e6%8e%a5%e7%bb%84%e4%bb%b6%e4%b8%8e%20di">§</a>连接组件与 DI</h2>
<p>DI 系统提供了钩子/服务机制，但如何将钩子/服务与 React 组件连接起来呢？这就需要<em>驱动层 Driver Layer</em>。<br/><span class="post-soft-break"></span>驱动层的核心思路是：在组件中创建一个驱动函数，从 DI 系统获取所有注册的钩子/服务，然后将这些钩子/服务绑定到实际的 DOM 事件或 React 生命周期上。</p>
<h3 id="%e9%a9%b1%e5%8a%a8%e5%b1%82%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86"><a class="post-anchor" href="#%e9%a9%b1%e5%8a%a8%e5%b1%82%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86">§</a>驱动层工作原理</h3>
<p>DI 系统提供了钩子机制，但如何将钩子与 React 组件连接起来呢？这就需要<em>驱动层 Driver Layer</em>。驱动层的核心思路是：在组件中创建一个驱动函数，从 DI 系统获取所有注册的钩子，然后将这些钩子绑定到实际的 DOM 事件或 React 生命周期上。<br/><span class="post-soft-break"></span>以事件监听器钩子为例，展示驱动层的工作原理。首先，各个插件通过<code>registerHook</code>注册事件监听钩子，这些钩子包含了事件处理函数，比如<code>onMouseDown</code>、<code>onMouseUp</code>等。然后，在组件中创建一个驱动层函数（如<code>useEventListenerDriver</code>），这个函数使用<code>useHook</code>从 DI 系统获取所有注册的事件监听钩子。接下来，驱动层将这些钩子中的事件处理函数绑定到实际的 DOM 事件监听器上，比如将<code>onMouseDown</code>绑定到<code>mousedown</code>事件。当事件发生时，驱动层会按顺序调用所有相关的钩子函数，实现事件分发。最后，当组件卸载时，驱动层会清理所有事件监听器，避免内存泄漏。<br/><span class="post-soft-break"></span>这种设计的好处是插件只需要注册钩子，不需要关心事件如何绑定。驱动层统一管理事件监听，避免重复绑定，同时钩子可以按<code>order</code>排序，控制执行顺序。更重要的是，这种设计实现了组件与 DI 系统的<em>解耦</em>，组件不需要知道有哪些插件注册了钩子，只需要调用驱动层即可，让代码更加模块化和易于维护。</p>
<h3 id="%e9%a9%b1%e5%8a%a8%e5%b1%82%e5%ae%9e%e7%8e%b0%e7%a4%ba%e4%be%8b"><a class="post-anchor" href="#%e9%a9%b1%e5%8a%a8%e5%b1%82%e5%ae%9e%e7%8e%b0%e7%a4%ba%e4%be%8b">§</a>驱动层实现示例</h3>
<p>首先，定义事件监听钩子接口：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">7</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">8</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 事件监听 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-interface lsp-keyword-control-export">export</span> <span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22propertyName%22,%22order%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D%5D">order</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-keyword-operator-optional" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22propertyName%22,%22order%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D%5D">?</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseDown%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onMouseDown</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-keyword-operator-optional" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseDown%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">?</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent%22%5D">event</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type lsp-error-token" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22MouseEvent%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">MouseEvent</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2304" title="点击查看错误详细信息">[TS2304]</a> Cannot find name 'MouseEvent'.</li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseUp%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onMouseUp</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-keyword-operator-optional" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseUp%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">?</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent%22%5D">event</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type lsp-error-token" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22MouseEvent%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">MouseEvent</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2304" title="点击查看错误详细信息">[TS2304]</a> Cannot find name 'MouseEvent'.</li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onClick%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onClick</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-keyword-operator-optional" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onClick%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent):%20%22,%5B%22keyword%22,%22void%22%5D%5D">?</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20MouseEvent%22%5D">event</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type lsp-error-token" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22MouseEvent%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">MouseEvent</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-method-declaration lsp-meta-return-type lsp-support-type-primitive">void</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2304" title="点击查看错误详细信息">[TS2304]</a> Cannot find name 'MouseEvent'.</li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 事件监听钩子 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22%3E%22%5D">IEventListenerHook</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createServiceKey%22%5D%5D">createServiceKey</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-string-quoted-single">IEventListenerHook</span><span class="lsp-meta-var-expr lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>在组件中创建驱动层，将钩子绑定到 DOM 事件：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">4</li><li class="">5</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="">31</li><li class="">32</li><li class="">33</li><li class="">34</li><li class="">35</li><li class="">36</li><li class="">37</li><li class="">38</li><li class="">39</li><li class="">40</li><li class="">41</li><li class="">42</li><li class="">43</li><li class="">44</li><li class="">45</li><li class="">46</li><li class="">47</li><li class="">48</li><li class="">49</li><li class="">50</li><li class="">51</li><li class="">52</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D%5D">useHook</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5Cn(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject/IEventListenerHook</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useRef%22%5D%5D">useRef</span><span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useEffect%22%5D%5D">useEffect</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-error-token">react</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-keyword-control-exportx">export</span> <span class="lsp-sourcex lsp-meta-functionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22useEventListenerDriver%22%5D,%22(%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20React.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E):%20%22,%5B%22keyword%22,%22void%22%5D%5D">useEventListenerDriver</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20React.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E%22%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-type-modulex lsp-error-token" ls-info="%5B%5D">React</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22React%22%5D,%22.%22,%5B%22aliasName%22,%22RefObject%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">RefObject</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-meta-type-parametersx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22HTMLDivElement%22%5D%5D">HTMLDivElement</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2503" title="点击查看错误详细信息">[TS2503]</a> Cannot find namespace 'React'.</li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx"> 从 DI 系统获取所有注册的事件监听钩子</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">hooks</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useHook%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useHook%22%5D%5D">useHook</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-readwritex" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">IEventListenerHook</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useEffect%22%5D%5D">useEffect</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-control-conditionalx">if</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-operator-logicalx">!</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-objectx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20React.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E%22%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-support-variable-property-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">current</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-keyword-control-flowx">return</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-objectx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20React.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E%22%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-support-variable-property-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">current</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx"> 按 order 排序钩子</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sortedHooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">sortedHooks</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">hooks</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-support-functionx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Array%22%5D,%22%3C%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22%3E.%22,%5B%22methodName%22,%22slice%22%5D,%22(%22,%5B%22parameterName%22,%22start%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D,%22,%20%22,%5B%22parameterName%22,%22end%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D,%22):%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">slice</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-support-functionx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Array%22%5D,%22%3C%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22%3E.%22,%5B%22methodName%22,%22sort%22%5D,%22(%22,%5B%22parameterName%22,%22compareFn%22%5D,%22?:%20(%22,%5B%22parameterName%22,%22a%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22,%20%22,%5B%22parameterName%22,%22b%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22number%22%5D,%22):%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">sort</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22a%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">a</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-separator-parameterx">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22b%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">b</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-objectx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22a%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">a</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-propertyx" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22propertyName%22,%22order%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D%5D">order</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-logicalx">??</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-constant-numeric-decimalx">0</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-arithmeticx">-</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-objectx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22b%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">b</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-propertyx" ls-info="%5B%22(property)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22propertyName%22,%22order%22%5D,%22?:%20%22,%5B%22keyword%22,%22number%22%5D%5D">order</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-logicalx">??</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-constant-numeric-decimalx">0</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx"> 绑定鼠标按下事件</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleMouseDown%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleMouseDown</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">event</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">MouseEvent</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-control-loopx">for</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">hook</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-operator-expression-ofx">of</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sortedHooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">sortedHooks</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">hook</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseDown%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onMouseDown</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessor-optionalx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseDown%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">?.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-support-variable-domx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">event</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx"> 绑定鼠标释放事件</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleMouseUp%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleMouseUp</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">event</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">MouseEvent</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-control-loopx">for</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">hook</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-operator-expression-ofx">of</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sortedHooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">sortedHooks</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">hook</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseUp%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onMouseUp</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessor-optionalx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onMouseUp%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">?.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-support-variable-domx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">event</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx"> 绑定点击事件</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleClick%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleClick</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">event</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">MouseEvent</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-control-loopx">for</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">hook</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-operator-expression-ofx">of</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sortedHooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">sortedHooks</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D%5D">hook</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onClick%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">onClick</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessor-optionalx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22IEventListenerHook%22%5D,%22.%22,%5B%22methodName%22,%22onClick%22%5D,%22?(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">?.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-support-variable-domx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D%5D">event</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx"> 注册事件监听器</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">addEventListener</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">mousedown</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleMouseDown%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleMouseDown</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">addEventListener</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">mouseup</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleMouseUp%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleMouseUp</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">addEventListener</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">click</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleClick%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleClick</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-comment-line-double-slashx"> 清理函数</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-storage-type-function-arrowx">=&gt;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">removeEventListener</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">mousedown</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleMouseDown%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleMouseDown</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">removeEventListener</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">mouseup</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleMouseUp%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleMouseUp</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22element%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">element</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">removeEventListener</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex">click</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22handleClick%22%5D,%22:%20(%22,%5B%22parameterName%22,%22event%22%5D,%22:%20%22,%5B%22localName%22,%22MouseEvent%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22void%22%5D%5D">handleClick</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-arrowx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-meta-brace-squarex">[</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hooks%22%5D,%22:%20%22,%5B%22aliasName%22,%22IEventListenerHook%22%5D,%22%5B%5D%22%5D">hooks</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-variable-other-readwritex" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20React.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E%22%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-meta-brace-squarex">]</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<p>最后，将 DI 系统中的钩子与 DOM 事件连接：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22React%22%5D%5D">React</span><span class="lsp-sourcex lsp-meta-importx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useRef%22%5D%5D">useRef</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-error-token">react</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx lsp-error-token">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22useEventListenerDriver%22%5D,%22(%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20%22,%5B%22aliasName%22,%22React%22%5D,%22.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useEventListenerDriver%22%5D%5D">useEventListenerDriver</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject/useEventListenerDriver</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22Component%22%5D,%22():%20%22,%5B%22keyword%22,%22any%22%5D%5D">Component</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ref%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">ref</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useRef%22%5D%5D">useRef</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-type-parametersx lsp-entity-name-typex" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22localName%22,%22HTMLDivElement%22%5D%5D">HTMLDivElement</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-constant-language-nullx">null</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx lsp-punctuation-definition-commentx">//</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-comment-line-double-slashx"> 使用驱动层，将钩子绑定到 DOM 事件</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-entity-name-functionx" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22useEventListenerDriver%22%5D,%22(%22,%5B%22parameterName%22,%22ref%22%5D,%22:%20%22,%5B%22aliasName%22,%22React%22%5D,%22.RefObject%3C%22,%5B%22localName%22,%22HTMLDivElement%22%5D,%22%3E):%20%22,%5B%22keyword%22,%22void%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useEventListenerDriver%22%5D%5D">useEventListenerDriver</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ref%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-entity-other-attribute-namex" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22ref%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-keyword-operator-assignmentx">=</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-punctuation-section-embedded-beginx">{</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-meta-embedded-expressionx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22ref%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">ref</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-tag-attributesx lsp-punctuation-section-embedded-endx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-meta-jsx-childrenx">组件内容</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-beginx">&lt;/</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-entity-name-tagx" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">div</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-tagx lsp-punctuation-definition-tag-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<h2 id="%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af"><a class="post-anchor" href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af">§</a>实际应用场景</h2>
<p>在实际项目中，通常会这样组织代码：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="">31</li><li class="">32</li><li class="">33</li><li class="">34</li><li class="">35</li><li class="">36</li><li class="">37</li><li class="">38</li><li class="">39</li><li class="">40</li><li class="">41</li><li class="">42</li><li class="">43</li><li class="">44</li><li class="">45</li><li class="">46</li><li class="">47</li><li class="">48</li><li class="">49</li><li class="">50</li><li class="">51</li><li class="">52</li><li class="">53</li><li class="">54</li><li class="">55</li><li class="">56</li><li class="">57</li><li class="">58</li><li class="">59</li><li class="">60</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-comment">// services/logger.ts</span></li><li class=""><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ILoggerService</span> = createServiceKey&lt;<span class="hljs-title class_">ILoggerService</span>&gt;(<span class="hljs-string">&#x27;ILoggerService&#x27;</span>);</li><li class=""></li><li class=""><span class="hljs-comment">// plugins/logger/register.ts</span></li><li class=""><span class="hljs-keyword">import</span> { defineGlobalPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@@local/inject&#x27;</span>;</li><li class=""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ILoggerService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../services/logger&#x27;</span>;</li><li class=""></li><li class=""><span class="hljs-title function_">defineGlobalPlugin</span>(<span class="hljs-function">(<span class="hljs-params">{ registerService }</span>) =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> <span class="hljs-attr">logger</span>: <span class="hljs-title class_">ILoggerService</span> = {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>] <span class="hljs-subst">${message}</span>`</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  },</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">error</span>(<span class="hljs-params"><span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toISOString()}</span>] <span class="hljs-subst">${message}</span>`</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  },</li><li class=""><span class="code-block-split"></span>  };</li><li class=""><span class="code-block-split"></span>  <span class="hljs-title function_">registerService</span>(<span class="hljs-title class_">ILoggerService</span>, logger);</li><li class="">});</li><li class=""></li><li class=""><span class="hljs-comment">// context/index.ts</span></li><li class=""><span class="hljs-keyword">export</span> {</li><li class=""><span class="code-block-split"></span>  useServiceWithGlobal <span class="hljs-keyword">as</span> useService,</li><li class=""><span class="code-block-split"></span>  useHookWithGlobal <span class="hljs-keyword">as</span> useHook,</li><li class=""><span class="code-block-split"></span>  useLifeCycleWithGlobal <span class="hljs-keyword">as</span> useLifeCycle,</li><li class=""><span class="code-block-split"></span>  useInjectInstall,</li><li class=""><span class="code-block-split"></span>  <span class="hljs-title class_">InjectContext</span>,</li><li class=""><span class="code-block-split"></span>  defineGlobalPlugin <span class="hljs-keyword">as</span> definePlugin,</li><li class="">} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@@local/inject&#x27;</span>;</li><li class=""></li><li class=""><span class="hljs-comment">// components/App.tsx</span></li><li class=""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InjectContext</span>, useInjectInstall, useService } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../context&#x27;</span>;</li><li class=""><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ILoggerService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../services/logger&#x27;</span>;</li><li class=""></li><li class=""><span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> logger = <span class="hljs-title function_">useService</span>(<span class="hljs-title class_">ILoggerService</span>);</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  logger.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;应用已加载&#x27;</span>);</li><li class=""><span class="code-block-split"></span>  }, [logger]);</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>应用内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;</li><li class="">}</li><li class=""></li><li class=""><span class="hljs-keyword">function</span> <span class="hljs-title function_">Initialization</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> [pluginInitialized] = <span class="hljs-title function_">useInjectInstall</span>();</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">if</span> (!pluginInitialized) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li class=""><span class="code-block-split"></span>  }</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span> /&gt;</span></span>;</li><li class="">}</li><li class=""></li><li class=""><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">return</span> (</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">InjectContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{new</span> <span class="hljs-attr">Map</span>()}&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-tag">&lt;<span class="hljs-name">Initialization</span> /&gt;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-tag">&lt;/<span class="hljs-name">InjectContext.Provider</span>&gt;</span></span></li><li class=""><span class="code-block-split"></span>  );</li><li class="">}</li></ul></span></code></pre>
<p>这种组织方式让代码结构清晰，易于维护。每个功能模块都有自己的作用域和快捷方法，使用起来非常方便。</p>
<h1 id="%e6%a0%b8%e5%bf%83%e5%ae%9e%e7%8e%b0%e8%a7%a3%e6%9e%90"><a class="post-anchor" href="#%e6%a0%b8%e5%bf%83%e5%ae%9e%e7%8e%b0%e8%a7%a3%e6%9e%90">§</a>核心实现解析</h1>
<h2 id="%e6%9c%8d%e5%8a%a1%e9%94%ae%e7%9a%84%e7%b1%bb%e5%9e%8b%e4%b8%8e%e5%ae%9e%e7%8e%b0"><a class="post-anchor" href="#%e6%9c%8d%e5%8a%a1%e9%94%ae%e7%9a%84%e7%b1%bb%e5%9e%8b%e4%b8%8e%e5%ae%9e%e7%8e%b0">§</a>服务键的类型与实现</h2>
<p>在第三部分中，我们看到了如何使用 <code>createServiceKey</code> 创建服务键。现在让我们深入看看它的实现：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-keyword-control-export">export</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">createServiceKey</span><span class="lsp-meta-function lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">T</span><span class="lsp-meta-function lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">name</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-function lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-return-type lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-function lsp-meta-return-type lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-return-type lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">T</span><span class="lsp-meta-function lsp-meta-return-type lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Symbol%22%5D,%22:%20%22,%5B%22interfaceName%22,%22SymbolConstructor%22%5D,%22%5Cn(%22,%5B%22parameterName%22,%22description%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">Symbol</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">name</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-as">as</span> <span class="lsp-meta-function lsp-meta-block lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-function lsp-meta-block lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22createServiceKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22name%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22):%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">T</span><span class="lsp-meta-function lsp-meta-block lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>实现很简单——创建一个 <code>Symbol</code>，然后通过类型断言转换为品牌类型。关键在于类型定义：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-type-declaration lsp-keyword-control-export">export</span> <span class="lsp-meta-type-declaration lsp-storage-type-type">type</span> <span class="lsp-meta-type-declaration lsp-entity-name-type-alias" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%22%5D">ServiceTypeWithKey</span><span class="lsp-meta-type-declaration lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-type-declaration lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">T</span><span class="lsp-meta-type-declaration lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span> <span class="lsp-meta-type-declaration lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-type-declaration lsp-support-type-primitive">symbol</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-type-declaration lsp-keyword-operator-type">&amp;</span> <span class="lsp-meta-type-declaration lsp-meta-object-type lsp-punctuation-definition-block">{</span> <span class="lsp-meta-type-declaration lsp-meta-object-type lsp-meta-field-declaration lsp-storage-modifier">readonly</span> <span class="lsp-meta-type-declaration lsp-meta-object-type lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">__type</span><span class="lsp-meta-type-declaration lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-type-declaration lsp-meta-object-type lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">T</span> <span class="lsp-meta-type-declaration lsp-meta-object-type lsp-punctuation-definition-block">}</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>这个类型定义表示<code>ServiceTypeWithKey&lt;T&gt;</code>是<code>symbol</code>类型与一个只读属性的交集类型。<code>__type</code>属性只在编译期存在，用于类型推导，运行时会被 TypeScript 擦除。<br/><span class="post-soft-break"></span>当我们使用<code>createServiceKey&lt;ILoggerService&gt;(&#x27;ILoggerService&#x27;)</code>时，返回的<code>Symbol</code>在运行时只是一个普通的标识符，但在编译期，TypeScript 会将其视为带有<code>ILoggerService</code>类型标记的品牌类型。这样，当我们使用这个服务键时，TypeScript 可以从类型参数<code>T</code>推导出对应的服务类型，实现类型安全的依赖注入。</p>
<h2 id="%e6%8f%92%e4%bb%b6%e6%b3%a8%e5%86%8c%e4%b8%8e%e5%ae%89%e8%a3%85%e6%9c%ba%e5%88%b6"><a class="post-anchor" href="#%e6%8f%92%e4%bb%b6%e6%b3%a8%e5%86%8c%e4%b8%8e%e5%ae%89%e8%a3%85%e6%9c%ba%e5%88%b6">§</a>插件注册与安装机制</h2>
<p>在第三部分中，我们看到了如何使用<code>definePlugin</code>注册插件。现在让我们看看插件是如何被管理和安装的。</p>
<h3 id="%e6%8f%92%e4%bb%b6%e5%85%83%e4%bf%a1%e6%81%af%e7%ae%a1%e7%90%86"><a class="post-anchor" href="#%e6%8f%92%e4%bb%b6%e5%85%83%e4%bf%a1%e6%81%af%e7%ae%a1%e7%90%86">§</a>插件元信息管理</h3>
<p>系统使用全局 Map 来管理插件信息：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">PluginMetaInfos</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">PluginInstaller</span>, <span class="hljs-title class_">IPluginMeta</span>&gt;();</li></ul></span></code></pre>
<p>这个<em>Map</em>的键是插件安装器函数本身，值包含作用域和安装器。注册插件时，系统会检查插件是否已经注册过：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-keyword">function</span> <span class="hljs-title function_">definePlugin</span>(<span class="hljs-params"><span class="hljs-attr">scope</span>: <span class="hljs-built_in">symbol</span>, <span class="hljs-attr">installer</span>: <span class="hljs-title class_">PluginInstaller</span></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">PluginMetaInfos</span>.<span class="hljs-title function_">has</span>(installer)) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title class_">PluginMetaInfos</span>.<span class="hljs-title function_">set</span>(installer, {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  scope,</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  installer,</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  });</li><li class=""><span class="code-block-split"></span>  }</li><li class="">}</li></ul></span></code></pre>
<p>这种设计允许同一个插件函数只注册一次，即使多次调用<code>definePlugin</code>也不会重复注册。同时，使用函数本身作为键，可以确保函数引用相同的插件不会重复注册。</p>
<h3 id="%e4%bd%9c%e7%94%a8%e5%9f%9f%e6%a0%91%e7%9a%84%e5%88%9b%e5%bb%ba"><a class="post-anchor" href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e6%a0%91%e7%9a%84%e5%88%9b%e5%bb%ba">§</a>作用域树的创建</h3>
<p>在<code>useInjectInstall</code>被调用时，系统首先创建作用域树：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li><li class="">29</li><li class="">30</li><li class="">31</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ScopeMetaInfos%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ScopeMetaInfos%22%5D%5D">ScopeMetaInfos</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">IScopeContainer</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-storage-modifier">declare</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22createScopeData%22%5D,%22(%22,%5B%22parameterName%22,%22symbol%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentContainer%22%5D,%22?:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">createScopeData</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22symbol%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">symbol</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">symbol</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parentContainer</span><span class="lsp-meta-function lsp-meta-parameters lsp-keyword-operator-optional" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">?</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">IScopeContainer</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type">|</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-builtin">null</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span></li><li class=""><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-function lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-return-type lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">IScopeContainer</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22createScope%22%5D,%22(%22,%5B%22parameterName%22,%22scopeMeta%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22ScopeMetaInfos%22%5D,%22,%20%22,%5B%22parameterName%22,%22manager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">createScope</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scopeMeta%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%3E%22%5D">scopeMeta</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-expression-typeof">typeof</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22ScopeMetaInfos%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ScopeMetaInfos%22%5D%5D">ScopeMetaInfos</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span> <span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22manager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">manager</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%22(local%20function)%20%22,%5B%22functionName%22,%22createScopeRecursive%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22?:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">createScopeRecursive</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">symbol</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">parentScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">symbol</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type">|</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-builtin">null</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-constant-language-null">null</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parentContainer</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">parentScope</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-ternary">?</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22manager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">manager</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">get</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">parentScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-ternary">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-constant-language-null">null</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22createScopeData%22%5D,%22(%22,%5B%22parameterName%22,%22symbol%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentContainer%22%5D,%22?:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">createScopeData</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parentContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parentContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22manager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">manager</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E.%22,%5B%22methodName%22,%22set%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22value%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22):%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">set</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22parent%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parent</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parentContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22parentContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">parentContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22children%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%5B%5D%22%5D">children</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Array%22%5D,%22%3C%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E.%22,%5B%22methodName%22,%22push%22%5D,%22(...%22,%5B%22parameterName%22,%22items%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%5B%5D):%20%22,%5B%22keyword%22,%22number%22%5D%5D">push</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">else</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22manager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">manager</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E.%22,%5B%22methodName%22,%22set%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22value%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22):%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">set</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22createScopeData%22%5D,%22(%22,%5B%22parameterName%22,%22symbol%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentContainer%22%5D,%22?:%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22aliasName%22,%22IScopeContainer%22%5D%5D">createScopeData</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22children%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%22%5D">children</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scopeMeta%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%3E%22%5D">scopeMeta</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%22%5D">get</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22children%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%22%5D">children</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-control-loop">for</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22child%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">child</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-operator-expression-of">of</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22children%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%5B%5D%22%5D">children</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(local%20function)%20%22,%5B%22functionName%22,%22createScopeRecursive%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22?:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">createScopeRecursive</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22child%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">child</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(local%20function)%20%22,%5B%22functionName%22,%22createScopeRecursive%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22parentScope%22%5D,%22?:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22null%22%5D,%22):%20%22,%5B%22keyword%22,%22void%22%5D%5D">createScopeRecursive</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>这个递归函数从根作用域开始，递归创建所有子作用域，并建立父子关系。每个作用域容器都包含指向父作用域的引用和子作用域数组，形成完整的树形结构。</p>
<h3 id="%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85%e8%bf%87%e7%a8%8b"><a class="post-anchor" href="#%e6%8f%92%e4%bb%b6%e5%ae%89%e8%a3%85%e8%bf%87%e7%a8%8b">§</a>插件安装过程</h3>
<p>作用域树创建完成后，系统开始安装插件：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-keyword">let</span> isInstalling = <span class="hljs-literal">true</span>;</li><li class=""></li><li class=""><span class="hljs-keyword">const</span> uninstaller = <span class="hljs-title function_">installer</span>({</li><li class=""><span class="code-block-split"></span>  <span class="hljs-attr">registerService</span>: <span class="hljs-function">(<span class="hljs-params">key, service</span>) =&gt;</span> { <span class="hljs-comment">/* 注册服务 */</span> },</li><li class=""><span class="code-block-split"></span>  <span class="hljs-attr">registerHook</span>: <span class="hljs-function">(<span class="hljs-params">key, hook</span>) =&gt;</span> { <span class="hljs-comment">/* 注册钩子 */</span> },</li><li class=""><span class="code-block-split"></span>  <span class="hljs-attr">getService</span>: <span class="hljs-function">(<span class="hljs-params">key</span>) =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">if</span> (isInstalling) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;在插件注册阶段不允许获取服务&#x27;</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  }</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getServiceWithScope</span>(key, scope, manager);</li><li class=""><span class="code-block-split"></span>  },</li><li class=""><span class="code-block-split"></span>  <span class="hljs-comment">// ...</span></li><li class="">});</li><li class=""></li><li class="">isInstalling = <span class="hljs-literal">false</span>;</li></ul></span></code></pre>
<p>安装过程的关键是<code>isInstalling</code>标志位。在插件安装器执行期间，这个标志为<code>true</code>，此时如果调用<code>getService</code>或<code>getHook</code>，会抛出错误。安装完成后，标志被设置为<code>false</code>，此时可以正常访问服务。这种设计强制插件在注册阶段只能注册服务，不能访问服务，从而避免了循环依赖问题。另外，如果插件返回了卸载函数，系统会将其注册为生命周期钩子，在组件卸载时自动调用。</p>
<h2 id="%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%ae%a1%e7%90%86%e4%b8%8e%e6%9c%8d%e5%8a%a1%e6%9f%a5%e6%89%be"><a class="post-anchor" href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%ae%a1%e7%90%86%e4%b8%8e%e6%9c%8d%e5%8a%a1%e6%9f%a5%e6%89%be">§</a>作用域管理与服务查找</h2>
<p>在第三部分中，我们看到了服务如何在不同作用域间共享。现在让我们看看服务查找的实现：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-function lsp-keyword-control-export">export</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">getServiceWithScope</span><span class="lsp-meta-function lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">symbol</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">ScopeManager</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-separator-parameter">,</span></li><li class=""><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span><span class="lsp-meta-function lsp-meta-return-type lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-return-type lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">T</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">let</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">ScopeManager</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">get</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-keyword-operator-logical">!</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-control-trycatch">throw</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-keyword-operator-new">new</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-meta-function-call lsp-support-class-error" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Error%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ErrorConstructor%22%5D,%22%5Cn%22,%5B%22keyword%22,%22new%22%5D,%22%20(%22,%5B%22parameterName%22,%22message%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22options%22%5D,%22?:%20%22,%5B%22interfaceName%22,%22ErrorOptions%22%5D,%22)%20=%3E%20%22,%5B%22localName%22,%22Error%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">Error</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template">未找到 </span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22String%22%5D,%22:%20%22,%5B%22interfaceName%22,%22StringConstructor%22%5D,%22%5Cn(%22,%5B%22parameterName%22,%22value%22%5D,%22?:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">String</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template"> 作用域</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">let</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">service</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IInjectContext%22%5D%5D">context</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IInjectContext%22%5D,%22.%22,%5B%22propertyName%22,%22ServiceMap%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E%22%5D">ServiceMap</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-function lsp-meta-block lsp-comment-line-double-slash"> 逐级向上查找</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-loop">while</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-keyword-operator-logical">!</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">service</span> <span class="lsp-meta-function lsp-meta-block lsp-keyword-operator-logical">&amp;&amp;</span> <span class="lsp-meta-function lsp-meta-block lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22parent%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">parent</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-support-variable-property-dom" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22parent%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">parent</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">service</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IInjectContext%22%5D%5D">context</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-variable-other-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IInjectContext%22%5D,%22.%22,%5B%22propertyName%22,%22ServiceMap%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E%22%5D">ServiceMap</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-function-call lsp-support-function-dom" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E):%20%22,%5B%22keyword%22,%22any%22%5D%5D">get</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-conditional">if</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-keyword-operator-logical">!</span><span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">service</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-keyword-control-trycatch">throw</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-keyword-operator-new">new</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-meta-function-call lsp-support-class-error" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Error%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ErrorConstructor%22%5D,%22%5Cn%22,%5B%22keyword%22,%22new%22%5D,%22%20(%22,%5B%22parameterName%22,%22message%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22options%22%5D,%22?:%20%22,%5B%22interfaceName%22,%22ErrorOptions%22%5D,%22)%20=%3E%20%22,%5B%22localName%22,%22Error%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">Error</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-punctuation-definition-string-template-begin">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template">未找到 </span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-begin">${</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22String%22%5D,%22:%20%22,%5B%22interfaceName%22,%22StringConstructor%22%5D,%22%5Cn(%22,%5B%22parameterName%22,%22value%22%5D,%22?:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">String</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-meta-embedded-line lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-meta-template-expression lsp-punctuation-definition-template-expression-end">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template"> 服务</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-string-template lsp-punctuation-definition-string-template-end">`</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-new-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-block lsp-punctuation-definition-block">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22let%22%5D,%22%20%22,%5B%22localName%22,%22service%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">service</span> <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-as">as</span> <span class="lsp-meta-function lsp-meta-block lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>这个算法从当前作用域开始查找，如果找不到，就向上查找父作用域，直到找到服务或到达根作用域。算法的时间复杂度是<code>O(h)</code>，其中<code>h</code>是作用域树的深度。在实际应用中，作用域树的深度通常不会很深，所以性能影响可以忽略。</p>
<p>钩子的查找更简单，只在当前作用域查找：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-importx">import</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-separator-commax">,</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-variable-other-readwrite-aliasx" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span> <span class="lsp-sourcex lsp-meta-importx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span> <span class="lsp-sourcex lsp-meta-importx lsp-keyword-control-fromx">from</span> <span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex">@@local/inject</span><span class="lsp-sourcex lsp-meta-importx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-punctuation-terminator-statementx">;</span></li><li class=""></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-keyword-control-exportx">export</span> <span class="lsp-sourcex lsp-meta-functionx lsp-storage-type-functionx">function</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-definition-functionx lsp-entity-name-functionx" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22getHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">getHookWithScope</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-type-parametersx lsp-entity-name-typex" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">T</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-beginx">(</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-beginx">&lt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-meta-type-parametersx lsp-entity-name-typex" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">T</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-meta-type-parametersx lsp-punctuation-definition-typeparameters-endx">&gt;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-separator-parameterx">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-support-type-primitivex">symbol</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-separator-parameterx">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">ScopeManager</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-entity-name-typex" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-separator-parameterx">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-variable-parameterx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22sort%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D%5D">sort</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-string-quoted-singlex">asc</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-keyword-operator-typex">|</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-string-quoted-singlex">desc</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-meta-type-annotationx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-string-quoted-singlex lsp-punctuation-definition-string-beginx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-string-quoted-singlex">asc</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-string-quoted-singlex lsp-punctuation-definition-string-endx">&#39;</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-separator-parameterx">,</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-parametersx lsp-punctuation-definition-parameters-endx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-return-typex lsp-keyword-operator-type-annotationx">:</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-return-typex lsp-entity-name-typex" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22functionName%22,%22getHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">T</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-return-typex lsp-meta-type-tuplex lsp-meta-brace-squarex">[</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-return-typex lsp-meta-type-tuplex lsp-meta-brace-squarex">]</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-storage-typex">const</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-var-single-variable-exprx lsp-meta-definition-variablex lsp-variable-other-constantx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-keyword-operator-assignmentx">=</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">ScopeManager</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">get</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-variable-other-readwritex" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-var-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-conditionalx">if</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-operator-logicalx">!</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-keyword-control-trycatchx">throw</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-keyword-operator-newx">new</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-meta-function-callx lsp-support-class-errorx" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Error%22%5D,%22:%20%22,%5B%22interfaceName%22,%22ErrorConstructor%22%5D,%22%5Cn%22,%5B%22keyword%22,%22new%22%5D,%22%20(%22,%5B%22parameterName%22,%22message%22%5D,%22?:%20%22,%5B%22keyword%22,%22string%22%5D,%22,%20%22,%5B%22parameterName%22,%22options%22%5D,%22?:%20%22,%5B%22interfaceName%22,%22ErrorOptions%22%5D,%22)%20=%3E%20%22,%5B%22localName%22,%22Error%22%5D,%22%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%221%22%5D,%22%20overload)%22%5D">Error</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-punctuation-definition-string-template-beginx">`</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex">未找到 </span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-meta-template-expressionx lsp-punctuation-definition-template-expression-beginx">${</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-meta-template-expressionx lsp-meta-embedded-linex lsp-meta-function-callx lsp-support-class-builtinx" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22String%22%5D,%22:%20%22,%5B%22interfaceName%22,%22StringConstructor%22%5D,%22%5Cn(%22,%5B%22parameterName%22,%22value%22%5D,%22?:%20%22,%5B%22keyword%22,%22any%22%5D,%22)%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">String</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-meta-template-expressionx lsp-meta-embedded-linex lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-meta-template-expressionx lsp-meta-embedded-linex lsp-variable-other-readwritex" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-meta-template-expressionx lsp-meta-embedded-linex lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-meta-template-expressionx lsp-punctuation-definition-template-expression-endx">}</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex"> 作用域</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-string-templatex lsp-punctuation-definition-string-template-endx">`</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-new-exprx lsp-meta-brace-roundx">)</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-control-flowx">return</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-objectx" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22scopeContainer%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D%5D">scopeContainer</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-object-propertyx" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22.%22,%5B%22propertyName%22,%22context%22%5D,%22:%20%22,%5B%22interfaceName%22,%22IInjectContext%22%5D%5D">context</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-variable-other-object-propertyx" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22IInjectContext%22%5D,%22.%22,%5B%22propertyName%22,%22HookMap%22%5D,%22:%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E,%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D%3E%22%5D">HookMap</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-punctuation-accessorx">.</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-function-callx lsp-support-function-domx" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E,%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D%3E.%22,%5B%22methodName%22,%22get%22%5D,%22(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E):%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D%22%5D">get</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">(</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-variable-other-readwritex" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-brace-roundx">)</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-keyword-operator-logicalx">??</span> <span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-meta-brace-squarex">[</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-meta-array-literalx lsp-meta-brace-squarex">]</span><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-terminator-statementx">;</span></li><li class=""><span class="lsp-sourcex lsp-meta-functionx lsp-meta-blockx lsp-punctuation-definition-blockx">}</span></li></ul></span></code></pre>
<p>钩子不会向上查找，每个作用域只返回自己注册的钩子，实现了作用域隔离。</p>
<h2 id="react%20%e9%9b%86%e6%88%90%e4%b8%8e%20hooks%20%e5%ae%9e%e7%8e%b0"><a class="post-anchor" href="#react%20%e9%9b%86%e6%88%90%e4%b8%8e%20hooks%20%e5%ae%9e%e7%8e%b0">§</a>React 集成与 Hooks 实现</h2>
<p>在第三部分中，我们看到了如何在组件中使用<code>useServiceWithGlobal</code>等方法。现在让我们看看这些 Hooks 的实现。</p>
<h3 id="context%20%e7%ae%a1%e7%90%86"><a class="post-anchor" href="#context%20%e7%ae%a1%e7%90%86">§</a>Context 管理</h3>
<p>系统使用<em>React Context</em>来管理作用域管理器：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createContext%22%5D%5D">createContext</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">react</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">InjectContext</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createContext%22%5D%5D">createContext</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22interfaceName%22,%22IScopeContainer%22%5D,%22%3E%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D%5D">IScopeManager</span><span class="lsp-meta-var-expr lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-new-expr lsp-keyword-operator-new">new</span> <span class="lsp-meta-var-expr lsp-new-expr lsp-meta-function-call lsp-support-class-builtin" ls-info="%5B%5B%22keyword%22,%22var%22%5D,%22%20%22,%5B%22localName%22,%22Map%22%5D,%22:%20%22,%5B%22interfaceName%22,%22MapConstructor%22%5D,%22%5Cn%22,%5B%22keyword%22,%22new%22%5D,%22%20()%20=%3E%20%22,%5B%22localName%22,%22Map%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22keyword%22,%22any%22%5D,%22%3E%20(%22,%5B%22operator%22,%22+%22%5D,%5B%22numericLiteral%22,%223%22%5D,%22%20overloads)%22%5D">Map</span><span class="lsp-meta-var-expr lsp-new-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-new-expr lsp-meta-brace-round">)</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>这个 Context 存储了整个作用域管理器，所有组件都可以通过<code>useContext</code>访问。在组件树的根部，我们创建<code>InjectContext.Provider</code>并传入一个<code>Map</code>：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript React</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li></ul><span class="code-block-box"><ul class="code-block-code"><li class="">&lt;<span class="hljs-title class_">InjectContext</span>.<span class="hljs-property">Provider</span> value={<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()}&gt;</li><li class=""><span class="code-block-split"></span>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Initialization</span> /&gt;</span></span></li><li class="">&lt;/<span class="hljs-title class_">InjectContext</span>.<span class="hljs-property">Provider</span>&gt;</li></ul></span></code></pre>
<p>这个<code>Map</code>就是整个应用共享的 DI 容器，所有子组件都可以通过<code>Context</code>访问它。</p>
<h3 id="hooks%20api%20%e5%ae%9e%e7%8e%b0"><a class="post-anchor" href="#hooks%20api%20%e5%ae%9e%e7%8e%b0">§</a>Hooks API 实现</h3>
<p>全局作用域的快捷方法实现如下：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D%5D">createReactHookWithScope</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22GlobalUse%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">GlobalUse</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22createReactHookWithScope%22%5D%5D">createReactHookWithScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22:%20%22,%5B%22keyword%22,%22typeof%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22RootScope%22%5D%5D">RootScope</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22useServiceWithGlobal%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">useServiceWithGlobal</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22GlobalUse%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">GlobalUse</span><span class="lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-variable-other-property" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useService%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">useService</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22useHookWithGlobal%22%5D,%22:%20%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22)%20=%3E%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">useHookWithGlobal</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22GlobalUse%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">GlobalUse</span><span class="lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-variable-other-property" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useHook%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%22%5D">useHook</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-keyword-control-export">export</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22useLifeCycleWithGlobal%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%22%5D">useLifeCycleWithGlobal</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22GlobalUse%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D;%5Cn%7D%22%5D">GlobalUse</span><span class="lsp-meta-var-expr lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-variable-other-property" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useLifeCycle%22%5D,%22():%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%5B%22,%5B%22keyword%22,%22boolean%22%5D,%22%5D%22%5D">useLifeCycle</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>这些方法内部使用<code>createReactHookWithScope</code>创建：</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22getServiceWithScope%22%5D%5D">getServiceWithScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22aliasName%22,%22getHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22getHookWithScope%22%5D%5D">getHookWithScope</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D%5D">InjectContext</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single">@@local/inject</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">{</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useContext%22%5D%5D">useContext</span><span class="lsp-meta-import lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-import lsp-meta-block lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useMemo%22%5D%5D">useMemo</span> <span class="lsp-meta-import lsp-meta-block lsp-punctuation-definition-block">}</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">react</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'react' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-meta-function lsp-keyword-control-export">export</span> <span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22createReactHookWithScope%22%5D,%22(%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22):%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%22%5D">createReactHookWithScope</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">symbol</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%22%5D">hook</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useService%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">useService</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22methodName%22,%22useService%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22methodName%22,%22useService%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22getServiceWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22getServiceWithScope%22%5D%5D">getServiceWithScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useContext%22%5D%5D">useContext</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D%5D">InjectContext</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useHook%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">useHook</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22methodName%22,%22useHook%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22keyword%22,%22symbol%22%5D,%22%20&%20%7B%5Cn%20%20%20%20%22,%5B%22keyword%22,%22readonly%22%5D,%22%20%22,%5B%22propertyName%22,%22__type%22%5D,%22:%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%7D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D%5D">ServiceTypeWithKey</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-begin">&lt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-entity-name-type" ls-info="%5B%22(type%20parameter)%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%20%22,%5B%22keyword%22,%22in%22%5D,%22%20%22,%5B%22methodName%22,%22useHook%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">T</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-meta-type-parameters lsp-punctuation-definition-typeparameters-end">&gt;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-separator-parameter">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22sort%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D%5D">sort</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-keyword-operator-optional" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22sort%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D%5D">?</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-string-quoted-single">asc</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type">|</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-string-quoted-single">desc</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-meta-type-annotation lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22context%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">context</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useContext%22%5D%5D">useContext</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%22(alias)%20%22,%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22InjectContext%22%5D%5D">InjectContext</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22useMemo%22%5D%5D">useMemo</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(alias)%20%22,%5B%22aliasName%22,%22getHookWithScope%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D,%22,%20%22,%5B%22parameterName%22,%22ScopeManager%22%5D,%22:%20%22,%5B%22aliasName%22,%22IScopeManager%22%5D,%22,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22%5B%5D%5Cn%22,%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22getHookWithScope%22%5D%5D">getHookWithScope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22context%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">context</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22sort%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D%5D">sort</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E%22%5D">key</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22scope%22%5D,%22:%20%22,%5B%22keyword%22,%22symbol%22%5D%5D">scope</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22sort%22%5D,%22:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D%5D">sort</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22context%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">context</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-definition-method lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22methodName%22,%22useLifeCycle%22%5D,%22():%20%22,%5B%22keyword%22,%22void%22%5D%5D">useLifeCycle</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-comment-line-double-slash"> 生命周期管理逻辑</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-method-declaration lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22hook%22%5D,%22:%20%7B%5Cn%20%20%20%20useService%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E):%20%22,%5B%22typeParameterName%22,%22T%22%5D,%22;%5Cn%20%20%20%20useHook%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E(%22,%5B%22parameterName%22,%22key%22%5D,%22:%20%22,%5B%22aliasName%22,%22ServiceTypeWithKey%22%5D,%22%3C%22,%5B%22typeParameterName%22,%22T%22%5D,%22%3E,%20%22,%5B%22parameterName%22,%22sort%22%5D,%22?:%20%22,%5B%22stringLiteral%22,%22%5C%22asc%5C%22%22%5D,%22%20%7C%20%22,%5B%22stringLiteral%22,%22%5C%22desc%5C%22%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D,%22;%5Cn%20%20%20%20useLifeCycle():%20%22,%5B%22keyword%22,%22void%22%5D,%22;%5Cn%7D%22%5D">hook</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p><code>useService</code>直接调用查找函数，而<code>useHook</code>使用<code>useMemo</code>缓存结果，避免不必要的重新计算。这样，开发者可以为特定作用域创建一套<em>Hooks</em>，使用时就不需要每次都传入作用域参数，简化了 API。</p>
<h3 id="%e5%88%9d%e5%a7%8b%e5%8c%96%20hook"><a class="post-anchor" href="#%e5%88%9d%e5%a7%8b%e5%8c%96%20hook">§</a>初始化 Hook</h3>
<p><code>useInjectInstall</code>的实现如下：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useInjectInstall</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> manager = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">InjectContext</span>);</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> [isInitialized, setIsInitialized] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 创建作用域</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">createScope</span>(<span class="hljs-title class_">ScopeMetaInfos</span>, manager);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 安装插件</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">installPlugin</span>(<span class="hljs-title class_">PluginMetaInfos</span>, manager);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 标记初始化完成</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">setIsInitialized</span>(<span class="hljs-literal">true</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">setIsInitialized</span>(<span class="hljs-literal">false</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  };</li><li class=""><span class="code-block-split"></span>  }, []);</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">return</span> [isInitialized] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;</li><li class="">}</li></ul></span></code></pre>
<p>这个<em>Hook</em>在组件挂载时执行一次，创建作用域树并安装所有插件。返回的<code>isInitialized</code>表示插件是否已初始化完成，组件可以根据这个状态决定是否渲染内容。</p>
<h2 id="%e9%98%b2%e6%ad%a2%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96%e7%9a%84%e6%9c%ba%e5%88%b6"><a class="post-anchor" href="#%e9%98%b2%e6%ad%a2%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96%e7%9a%84%e6%9c%ba%e5%88%b6">§</a>防止循环依赖的机制</h2>
<p>在第三部分中，我们看到了如何使用<code>getServices</code>实现延迟访问。现在让我们深入看看这个机制是如何工作的。</p>
<h3 id="%e6%b3%a8%e5%86%8c%e9%98%b6%e6%ae%b5%e9%99%90%e5%88%b6"><a class="post-anchor" href="#%e6%b3%a8%e5%86%8c%e9%98%b6%e6%ae%b5%e9%99%90%e5%88%b6">§</a>注册阶段限制</h3>
<p>系统通过<code>isInstalling</code>标志位，在插件注册阶段禁止访问服务。这不仅防止了循环依赖，还让插件的职责更加清晰：注册阶段只负责注册，不负责使用。</p>
<p>如果注册阶段发生错误，还会解析错误信息，以及提供简单的快捷建议。系统还会从调用栈中提取用户代码的位置信息，包括文件路径、行号和列号，让开发者可以直接看到错误发生的位置。</p>
<h3 id="getservices%20%e5%bb%b6%e8%bf%9f%e8%ae%bf%e9%97%ae%e5%ae%9e%e7%8e%b0"><a class="post-anchor" href="#getservices%20%e5%bb%b6%e8%bf%9f%e8%ae%bf%e9%97%ae%e5%ae%9e%e7%8e%b0">§</a>getServices 延迟访问实现</h3>
<p><code>getServices</code>使用 JavaScript 的<code>Object.defineProperty</code>实现延迟访问：</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-attr">getServices</span>: <span class="hljs-function">(<span class="hljs-params">services</span>) =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {};</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; = {};</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, serviceKey] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(services)) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(result, key, {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">get</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 检查是否在安装阶段访问服务</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">if</span> (isInstalling) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">throw</span> <span class="hljs-title function_">createInstallPhaseError</span>(<span class="hljs-string">&#x27;服务&#x27;</span>, serviceKey, installer, <span class="hljs-literal">true</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  }</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">if</span> (cache.<span class="hljs-title function_">hasOwnProperty</span>(key)) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> cache[key];</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  }</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">const</span> service = <span class="hljs-title function_">getServiceWithScope</span>(serviceKey, scope, manager);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  cache[key] = service;</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> service;</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  },</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  });</li><li class=""><span class="code-block-split"></span>  }</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">return</span> result <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;</li><li class="">}</li></ul></span></code></pre>
<p>这个实现的关键在于使用<code>get</code>访问器属性。当调用<code>getServices</code>时，返回的对象中的每个属性都是一个访问器属性，只有在实际访问时才会执行查找逻辑。这样，插件可以在注册阶段调用<code>getServices</code>获取对象引用，然后在生命周期钩子中再访问属性，实现延迟访问。</p>
<h2 id="%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86"><a class="post-anchor" href="#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86">§</a>生命周期管理</h2>
<p>在第三部分中，我们看到了如何使用生命周期钩子。现在让我们看看生命周期管理的实现。<br/><span class="post-soft-break"></span>生命周期管理的核心思路是收集所有生命周期钩子，按<code>order</code>排序并分组，然后按顺序执行。钩子按照<code>order</code>值排序，<code>order</code>越小优先级越高。相同<code>order</code>的钩子分为一组，组内并发执行，组间顺序执行。系统支持异步钩子，使用<code>Promise.all</code>等待所有异步钩子完成。卸载时，会按顺序<em>逆序</em>执行卸载钩子，确保清理顺序正确。这种设计让生命周期钩子的执行顺序可控。</p>
<h3 id="%e9%80%9a%e7%94%a8%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86"><a class="post-anchor" href="#%e9%80%9a%e7%94%a8%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86">§</a>通用生命周期管理</h3>
<p>根据钩子的特性，每个作用域获取生命周期钩子时，只能拿到当前作用域注册的钩子。这意味着每个作用域需要自己管理自己的生命周期。但系统已经封装了通用的生命周期管理方法，通过<code>createReactHookWithScope</code>创建的快捷 Hooks 中包含了<code>useLifeCycle</code>方法。</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li><li class="">18</li><li class="">19</li><li class="">20</li><li class="">21</li><li class="">22</li><li class="">23</li><li class="">24</li><li class="">25</li><li class="">26</li><li class="">27</li><li class="">28</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-title function_">useLifeCycle</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> hooks = hook.<span class="hljs-title function_">useHook</span>(<span class="hljs-title class_">ILifeCycleHook</span>);</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> [isInitialized, setIsInitialized] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 按 order 排序并分组</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">const</span> sortedHooks = hooks.<span class="hljs-title function_">slice</span>().<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">getOrder</span>(a.<span class="hljs-property">order</span>) - <span class="hljs-title function_">getOrder</span>(b.<span class="hljs-property">order</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  });</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">const</span> groups = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-title class_">ILifeCycleHook</span>[]&gt;();</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> hook <span class="hljs-keyword">of</span> sortedHooks) {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">const</span> order = <span class="hljs-title function_">getOrder</span>(hook.<span class="hljs-property">order</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  groups.<span class="hljs-title function_">set</span>(order, [...(groups.<span class="hljs-title function_">get</span>(order) ?? []), hook]);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  }</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 按 order 顺序执行挂载钩子，组内并发</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">executeHooks</span>(groups, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>)</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">setIsInitialized</span>(<span class="hljs-literal">true</span>));</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-comment">// 卸载时按 order 逆序执行卸载钩子</span></li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="code-block-split"></span>  <span class="hljs-title function_">executeHooks</span>(groups, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);</li><li class=""><span class="code-block-split"></span>  <span class="code-block-split"></span>  };</li><li class=""><span class="code-block-split"></span>  }, [hooks]);</li><li class=""><span class="code-block-split"></span></li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">return</span> [isInitialized] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;</li><li class="">}</li></ul></span></code></pre>
<p>这样，如果当前作用域内的生命周期是通用的形式，那么每个作用域只需要调用对应的<code>useLifeCycle</code>方法即可，不需要重复编写生命周期管理代码。而假如当前作用域的生命周期需要特殊的执行方式，那么也可以自己去写自定义的处理过程，保留了自由度。</p>
<pre class="code-block-wrapper"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="hljs-comment">// 全局作用域</span></li><li class=""><span class="hljs-keyword">function</span> <span class="hljs-title function_">GlobalComponent</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> [isInitialized] = <span class="hljs-title function_">useLifeCycleWithGlobal</span>();</li><li class=""><span class="code-block-split"></span>  <span class="hljs-comment">// ...</span></li><li class="">}</li><li class=""></li><li class=""><span class="hljs-comment">// 画布作用域</span></li><li class=""><span class="hljs-keyword">const</span> painterHooks = <span class="hljs-title function_">createReactHookWithScope</span>(<span class="hljs-title class_">PainterScope</span>);</li><li class=""><span class="hljs-keyword">function</span> <span class="hljs-title function_">PainterComponent</span>(<span class="hljs-params"></span>) {</li><li class=""><span class="code-block-split"></span>  <span class="hljs-keyword">const</span> [isInitialized] = painterHooks.<span class="hljs-title function_">useLifeCycle</span>();</li><li class=""><span class="code-block-split"></span>  <span class="hljs-comment">// ...</span></li><li class="">}</li></ul></span></code></pre>
<h1 id="%e8%ae%be%e8%ae%a1%e6%9d%83%e8%a1%a1%e4%b8%8e%e6%80%bb%e7%bb%93"><a class="post-anchor" href="#%e8%ae%be%e8%ae%a1%e6%9d%83%e8%a1%a1%e4%b8%8e%e6%80%bb%e7%bb%93">§</a>设计权衡与总结</h1>
<p>在实现过程中，我们做了几个关键决策，每个决策都有其权衡。</p>
<h2 id="%e8%ae%be%e8%ae%a1%e5%86%b3%e7%ad%96%e5%9b%9e%e9%a1%be"><a class="post-anchor" href="#%e8%ae%be%e8%ae%a1%e5%86%b3%e7%ad%96%e5%9b%9e%e9%a1%be">§</a>设计决策回顾</h2>
<h3 id="%e5%87%bd%e6%95%b0%e5%bc%8f%e6%8f%92%e4%bb%b6%e6%a8%a1%e5%bc%8f%20vs%20class%20%e6%a8%a1%e5%bc%8f"><a class="post-anchor" href="#%e5%87%bd%e6%95%b0%e5%bc%8f%e6%8f%92%e4%bb%b6%e6%a8%a1%e5%bc%8f%20vs%20class%20%e6%a8%a1%e5%bc%8f">§</a>函数式插件模式 vs Class 模式</h3>
<p>选择函数式插件模式而非 Class 模式，主要考虑与 React 生态的契合度。函数式插件更符合 React 的函数式风格，避免了装饰器的复杂性和版本差异问题。但这也意味着失去了自动依赖注入的能力，需要手动管理依赖关系。在实际使用中，虽然需要手动调用<code>getService</code>，但通过<code>getServices</code>的延迟访问机制，可以在生命周期钩子中安全地使用服务，避免了循环依赖问题。</p>
<h3 id="%e6%9c%8d%e5%8a%a1%e5%85%b1%e4%ba%ab%20vs%20%e9%92%a9%e5%ad%90%e9%9a%94%e7%a6%bb"><a class="post-anchor" href="#%e6%9c%8d%e5%8a%a1%e5%85%b1%e4%ba%ab%20vs%20%e9%92%a9%e5%ad%90%e9%9a%94%e7%a6%bb">§</a>服务共享 vs 钩子隔离</h3>
<p>服务采用向上查找策略，子作用域可以访问父作用域的服务，实现了服务共享。这种设计减少了重复注册，节约了资源，但也意味着父作用域无法访问子作用域的服务，保证了隔离性。钩子采用隔离策略，每个作用域只返回自己注册的钩子，实现了精确控制，但也意味着如果需要访问父作用域的钩子，需要通过<code>parent()</code>或<code>root()</code>显式跨作用域访问。这种设计在我个人的项目实践中很实用，多个画布实例可以共享全局服务，同时每个画布实例有独立的事件处理钩子。</p>
<h3 id="%e6%b3%a8%e5%86%8c%e9%98%b6%e6%ae%b5%e9%99%90%e5%88%b6"><a class="post-anchor" href="#%e6%b3%a8%e5%86%8c%e9%98%b6%e6%ae%b5%e9%99%90%e5%88%b6">§</a>注册阶段限制</h3>
<p>为了防止循环依赖，系统在插件注册阶段禁止访问服务。这种设计强制插件在注册阶段只能注册服务，不能访问服务，从而避免了循环依赖问题。但这也意味着插件需要将服务访问延迟到生命周期钩子中，增加了代码的复杂度。通过<code>getServices</code>的延迟访问机制，可以在一定程度上缓解这个问题，但仍然是需要开发者注意的设计约束。</p>
<h2 id="%e5%ae%9e%e9%aa%8c%e6%94%b6%e8%8e%b7"><a class="post-anchor" href="#%e5%ae%9e%e9%aa%8c%e6%94%b6%e8%8e%b7">§</a>实验收获</h2>
<p>通过这次实验，我们验证了几个设计思路的可行性。函数式插件模式在 React 生态中确实有其优势，类型安全通过品牌类型得到了很好的保障，作用域隔离机制能够很好地支持插件化架构。同时，我们也发现了一些问题。手动依赖管理确实不如自动注入方便，性能优化还有很大空间，测试支持需要进一步完善。<br/><span class="post-soft-break"></span>更重要的是，这次实验让我们对 DI 系统有了更深入的理解。不同的设计选择都有其适用场景，没有完美的方案，只有适合的方案。函数式插件模式虽然在某些方面不如 Class 模式方便，但在 React 生态中，它提供了更好的开发体验和更低的复杂度。</p>
<h3 id="%e5%bd%93%e5%89%8d%e9%99%90%e5%88%b6%e4%b8%8e%e4%b8%8d%e8%b6%b3"><a class="post-anchor" href="#%e5%bd%93%e5%89%8d%e9%99%90%e5%88%b6%e4%b8%8e%e4%b8%8d%e8%b6%b3">§</a>当前限制与不足</h3>
<p>这个系统目前还存在一些限制和不足。首先，它只支持 React 环境，无法用于其他框架或纯 JavaScript 环境。其次，服务查找需要遍历作用域链，可能影响性能，特别是在作用域树很深的情况下。第三，不支持服务工厂模式，每次返回的都是同一个实例，无法实现每次获取都创建新实例的需求。第四，不支持懒加载，服务在注册时即创建，无法实现按需创建。第五，不支持依赖自动注入，需要手动获取依赖，不如 Class 模式的构造函数注入方便。<br/><span class="post-soft-break"></span>在调试方面，虽然系统提供了详细的错误信息，但使用<code>Symbol</code>作为键，调试时不够直观。作用域关系不够可视化，在复杂的作用域树中，很难快速理解服务的位置和查找路径。</p>
<h3 id="%e6%94%b9%e8%bf%9b%e6%96%b9%e5%90%91"><a class="post-anchor" href="#%e6%94%b9%e8%bf%9b%e6%96%b9%e5%90%91">§</a>改进方向</h3>
<p>如果继续完善这个系统，可以考虑以下几个方向。首先是支持服务工厂，允许插件注册工厂函数，每次获取时创建新实例。第三是支持懒加载，允许服务在首次访问时才创建。第四是改进调试体验，提供可视化工具，帮助开发者理解作用域关系和服务位置。第五是增强测试支持，提供更好的 mock 机制和测试工具。<br/><span class="post-soft-break"></span>但这些改进都需要权衡。性能优化可能会增加代码复杂度，服务工厂和懒加载可能会让系统变得更加复杂，可视化工具需要额外的开发成本。在实际项目中，需要根据具体需求来决定是否实现这些功能。</p>
<h2 id="%e4%b8%8e%e4%b8%bb%e6%b5%81%20di%20%e5%ba%93%e7%9a%84%e5%af%b9%e6%af%94"><a class="post-anchor" href="#%e4%b8%8e%e4%b8%bb%e6%b5%81%20di%20%e5%ba%93%e7%9a%84%e5%af%b9%e6%af%94">§</a>与主流 DI 库的对比</h2>
<p>与主流的 DI 库相比，这个系统有其独特的优势，也有明显的不足。优势在于函数式风格更符合 React 生态，无需装饰器配置，调试更直观，作用域隔离机制更适合插件化架构。不足在于功能不如主流库完善，缺少依赖自动注入，性能可能不如主流库优化得好，生态工具不如主流库丰富。<br/><span class="post-soft-break"></span>主流 DI 库选择 Class 模式有其合理性。Class 模式提供了更强大的功能，更好的类型推导，更丰富的生态工具。但在 React 生态中，函数式插件模式提供了更好的开发体验和更低的复杂度。这两种方案各有适用场景，没有孰优孰劣，只有适合与否。</p>
<h2 id="%e5%af%b9%e8%af%bb%e8%80%85%e7%9a%84%e5%bb%ba%e8%ae%ae"><a class="post-anchor" href="#%e5%af%b9%e8%af%bb%e8%80%85%e7%9a%84%e5%bb%ba%e8%ae%ae">§</a>对读者的建议</h2>
<p>如果你在学习 DI 系统设计，可以参考这个实现，了解函数式插件模式的设计思路。如果你需要生产级解决方案，建议使用成熟的 DI 库。如果你也想探索不同的可能性，欢迎一起讨论。<br/><span class="post-soft-break"></span>技术探索的价值不在于完美，而在于思考与实践。这个实验性项目虽然不完美，但它提供了一个不同的视角，也许能启发新的思路。在技术选型时，没有银弹，只有适合的方案。重要的是理解不同方案的优劣，根据实际需求做出选择。</p></article></section><aside class="to-content"><header class="menu-list-header">目录</header><article class="menu-list-article"><ul class="menu-list"><li class="menu-item menu-level1"><a href="#%e5%bc%95%e8%a8%80%e4%b8%8e%e8%83%8c%e6%99%af"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>引言与背景</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e5%81%9a%e8%bf%99%e4%b8%aa%e5%ae%9e%e9%aa%8c">为什么做这个实验</a></li><li class="menu-item menu-level2"><a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e6%b2%a1%e6%9c%89%e4%bd%bf%e7%94%a8%e7%8e%b0%e6%88%90%e7%9a%84%e6%96%b9%e6%a1%88">为什么没有使用现成的方案</a></li><li class="menu-item menu-level2"><a href="#%e9%a1%b9%e7%9b%ae%e5%ae%9a%e4%bd%8d%e4%b8%8e%e8%ae%be%e8%ae%a1%e7%9b%ae%e6%a0%87">项目定位与设计目标</a></li></ul></li><li class="menu-item menu-level1"><a href="#%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>核心概念</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e6%8f%92%e4%bb%b6%e7%b3%bb%e7%bb%9f">插件系统</a></li><li class="menu-item menu-level2"><a href="#%e6%9c%8d%e5%8a%a1%e4%b8%8e%e9%92%a9%e5%ad%90">服务与钩子</a></li><li class="menu-item menu-level2"><a href="#%e4%bd%9c%e7%94%a8%e5%9f%9f">作用域</a></li><li class="menu-item menu-level2"><a href="#%e7%b1%bb%e5%9e%8b%e5%ae%89%e5%85%a8%e8%ae%be%e8%ae%a1">类型安全设计</a></li></ul></li><li class="menu-item menu-level1"><a href="#%e5%9f%ba%e7%a1%80%e4%bd%bf%e7%94%a8%e7%a4%ba%e4%be%8b"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>基础使用示例</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e6%9c%8d%e5%8a%a1%e4%b8%8e%e9%92%a9%e5%ad%90">服务与钩子</a></li><li class="menu-item menu-level2"><a href="#%e5%9c%a8%e7%bb%84%e4%bb%b6%e4%b8%ad%e4%bd%bf%e7%94%a8">在组件中使用</a></li><li class="menu-item menu-level2"><a href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%9a%84%e4%bd%bf%e7%94%a8">作用域的使用</a></li><li class="menu-item menu-level2"><a href="#%e8%bf%9e%e6%8e%a5%e7%bb%84%e4%bb%b6%e4%b8%8e%20di">连接组件与 DI</a></li><li class="menu-item menu-level2"><a href="#%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af">实际应用场景</a></li></ul></li><li class="menu-item menu-level1"><a href="#%e6%a0%b8%e5%bf%83%e5%ae%9e%e7%8e%b0%e8%a7%a3%e6%9e%90"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>核心实现解析</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e6%9c%8d%e5%8a%a1%e9%94%ae%e7%9a%84%e7%b1%bb%e5%9e%8b%e4%b8%8e%e5%ae%9e%e7%8e%b0">服务键的类型与实现</a></li><li class="menu-item menu-level2"><a href="#%e6%8f%92%e4%bb%b6%e6%b3%a8%e5%86%8c%e4%b8%8e%e5%ae%89%e8%a3%85%e6%9c%ba%e5%88%b6">插件注册与安装机制</a></li><li class="menu-item menu-level2"><a href="#%e4%bd%9c%e7%94%a8%e5%9f%9f%e7%ae%a1%e7%90%86%e4%b8%8e%e6%9c%8d%e5%8a%a1%e6%9f%a5%e6%89%be">作用域管理与服务查找</a></li><li class="menu-item menu-level2"><a href="#react%20%e9%9b%86%e6%88%90%e4%b8%8e%20hooks%20%e5%ae%9e%e7%8e%b0">React 集成与 Hooks 实现</a></li><li class="menu-item menu-level2"><a href="#%e9%98%b2%e6%ad%a2%e5%be%aa%e7%8e%af%e4%be%9d%e8%b5%96%e7%9a%84%e6%9c%ba%e5%88%b6">防止循环依赖的机制</a></li><li class="menu-item menu-level2"><a href="#%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%ae%a1%e7%90%86">生命周期管理</a></li></ul></li><li class="menu-item menu-level1"><a href="#%e8%ae%be%e8%ae%a1%e6%9d%83%e8%a1%a1%e4%b8%8e%e6%80%bb%e7%bb%93"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>设计权衡与总结</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e8%ae%be%e8%ae%a1%e5%86%b3%e7%ad%96%e5%9b%9e%e9%a1%be">设计决策回顾</a></li><li class="menu-item menu-level2"><a href="#%e5%ae%9e%e9%aa%8c%e6%94%b6%e8%8e%b7">实验收获</a></li><li class="menu-item menu-level2"><a href="#%e4%b8%8e%e4%b8%bb%e6%b5%81%20di%20%e5%ba%93%e7%9a%84%e5%af%b9%e6%af%94">与主流 DI 库的对比</a></li><li class="menu-item menu-level2"><a href="#%e5%af%b9%e8%af%bb%e8%80%85%e7%9a%84%e5%bb%ba%e8%ae%ae">对读者的建议</a></li></ul></li></ul></article></aside></div></article><footer class="main-footer"><span>Powered by </span><a href="https://github.com/xiaoboost" class="main-footer-href">Xiao</a><span> &amp; </span><a href="https://pages.github.com/" class="main-footer-href">Github Pages</a><span style="font-size:110%"> © </span><span>Since 2020</span></footer><div class="goto-top"><button class="goto-top-btn"><svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button></div><div data-width="8" data-mode="y" class="scrollbar invisible"><div class="slider"></div></div><script type="text/javascript" src="/scripts/layout.a1cf0ac821123b4e55217ecaae515f88.js"></script><script type="text/javascript" src="/scripts/post.3a108c44d494dcfb1ab471f7db3d5348.js"></script></body></html>