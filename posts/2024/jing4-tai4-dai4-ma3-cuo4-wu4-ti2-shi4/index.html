<!DOCTYPE html><html lang="zh-cmn-Hans-CN"><head><title>静态代码错误提示</title><meta name="charset" content="utf-8"/><meta name="author" content="xiao"/><meta name="description" content="TypeScript 官网逆向工程其之二——代码框的错误提示功能。"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="renderer" content="webkit"/><meta name="force-rendering" content="webkit"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><link rel="short icon" href="/images/favicon.d49166d79effe7141443cbb12866f5f5.ico"/><link rel="stylesheet" type="text/css" href="/styles/layout.afccee51719742708660d2a47ce938d1.css"/><link rel="stylesheet" type="text/css" href="/styles/post.d2fab5f40a24b2db660d67aa072ececb.css"/><link rel="stylesheet" type="text/css" href="/posts/2024/jing4-tai4-dai4-ma3-cuo4-wu4-ti2-shi4/styles/heading.dd3d9c9fb83b0d37c5bb5be907a2acdb.css"/></head><body><header class="main-header-wrapper"><span class="main-header"><a class="main-title" href="/">Dreaming Cat&#x27;s</a><nav class="main-nav"><a href="/" class="main-nav-item">首页</a><a href="/tags/" class="main-nav-item">标签</a><a href="/archive/" class="main-nav-item">归档</a><a href="/posts/about/" class="main-nav-item">关于</a></nav></span></header><article class="main-article-wrapper"><div class="main-article"><section class="post-default"><header class="post-header"><h1 class="post-header-title">静态代码错误提示</h1><time class="post-header-create">2024-05-08</time></header><article class="post-article"><p>在之前的<a target="_blank" rel="noreferrer" title="类型提示" href="/posts/2021/jing4-tai4-dai4-ma3-lei4-xing2-ti2-shi4/">《静态代码类型提示》</a>文章中，我逆向了基本的类型提示功能，五一期间我又闲着无聊，又逆向了<em>错误提示</em>功能。下面是基本功能展示，基于个人的喜好问题，样式调整的比较<del>花里胡哨</del>，希望大伙见谅。</p>
<h1 id="%e5%8a%9f%e8%83%bd%e5%b1%95%e7%a4%ba"><a class="post-anchor" href="#%e5%8a%9f%e8%83%bd%e5%b1%95%e7%a4%ba">§</a>功能展示</h1>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">6</li><li class="">7</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">8</li><li class="">9</li><li class="">10</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">11</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22Point%22%5D%5D">Point</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22Point%22%5D,%22.%22,%5B%22propertyName%22,%22pointX%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D%5D">pointX</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22point1%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Point%22%5D%5D">point1</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22Point%22%5D%5D">Point</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-constant-numeric-decimal lsp-error-token">123</span><span class="lsp-meta-var-expr lsp-constant-numeric-decimal lsp-storage-type-numeric-bigint lsp-error-token">n</span><span class="lsp-error-token"> </span><span class="lsp-meta-var-expr lsp-keyword-operator-arithmetic lsp-error-token">+</span><span class="lsp-error-token"> </span><span class="lsp-meta-var-expr lsp-constant-numeric-decimal lsp-error-token">123</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2365" title="点击查看错误详细信息">[TS2365]</a> Operator '+' cannot be applied to types '123n' and '123'.</li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22point2%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">point2</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-variable-other-readwrite lsp-error-token" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">point3</span> <span class="lsp-meta-var-expr lsp-keyword-operator-arithmetic">+</span> <span class="lsp-meta-var-expr lsp-variable-other-readwrite lsp-error-token" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">point4</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2552" title="点击查看错误详细信息">[TS2552]</a> Cannot find name 'point3'. Did you mean 'point1'?</li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2552" title="点击查看错误详细信息">[TS2552]</a> Cannot find name 'point4'. Did you mean 'point1'?</li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22point5%22%5D,%22:%20%22,%5B%22interfaceName%22,%22Point%22%5D%5D">point5</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22Point%22%5D%5D">Point</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-error-token" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22Point%22%5D,%22.%22,%5B%22propertyName%22,%22pointX%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D%5D">pointX</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">123</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2322" title="点击查看错误详细信息">[TS2322]</a> Type 'string' is not assignable to type 'number'.</li><li class=""><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<h1 id="%e5%8e%9f%e7%90%86%e8%ae%b2%e8%a7%a3"><a class="post-anchor" href="#%e5%8e%9f%e7%90%86%e8%ae%b2%e8%a7%a3">§</a>原理讲解</h1>
<p>其实整体功能还是从之前的语言服务延申出来的，能说的内容不多，<del>我只是想水篇博文</del>。</p>
<h2 id="%e8%8e%b7%e5%8f%96%e9%94%99%e8%af%af%e6%95%b0%e6%8d%ae"><a class="post-anchor" href="#%e8%8e%b7%e5%8f%96%e9%94%99%e8%af%af%e6%95%b0%e6%8d%ae">§</a>获取错误数据</h2>
<p>语言服务的初始化等内容请看<a target="_blank" rel="noreferrer" title="类型提示" href="/posts/2021/jing4-tai4-dai4-ma3-lei4-xing2-ti2-shi4/">《静态代码类型提示》</a>，错误数据毫无疑问也是从语言服务中拿出来的，这里我们需要使用另外的几个接口来拿数据。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-constant-language-import-export-all">*</span> <span class="lsp-meta-import lsp-keyword-control-as">as</span> <span class="lsp-meta-import lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">typescript</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'typescript' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 需要检查的文件路径 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22filePath%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">filePath</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 语言服务 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22server%22%5D,%22:%20ts.LanguageService%22%5D">server</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type-module" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D,%22.%22,%5B%22aliasName%22,%22LanguageService%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">LanguageService</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">program</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22server%22%5D,%22:%20ts.LanguageService%22%5D">server</span><span class="lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">getProgram</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sourceFile%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">sourceFile</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">program</span><span class="lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">?.</span><span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">getSourceFile</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22filePath%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">filePath</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22rawScriptDiagnostics%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D%22%5D">rawScriptDiagnostics</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-square">[</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-comment-line-double-slash"> 语法诊断</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-keyword-operator-spread">...</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">program</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">?.</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">getSyntacticDiagnostics</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sourceFile%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">sourceFile</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">)</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-keyword-operator-logical">??</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">)</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-comment-line-double-slash"> 语义诊断</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-keyword-operator-spread">...</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">program</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">?.</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">getSemanticDiagnostics</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sourceFile%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">sourceFile</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">)</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-keyword-operator-logical">??</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">)</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-comment-line-double-slash lsp-punctuation-definition-comment">//</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-comment-line-double-slash"> 声明诊断</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-keyword-operator-spread">...</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">program</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-punctuation-accessor-optional" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22program%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">?.</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">getDeclarationDiagnostics</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22sourceFile%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">sourceFile</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">)</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-keyword-operator-logical">??</span> <span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-array-literal lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-round">)</span><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-var-expr lsp-meta-array-literal lsp-meta-brace-square">]</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>最后得到的<code>rawScriptDiagnostics</code>数组即是当前文件的所有错误数据，诊断数据的类型还是很清晰的，都能望文生义。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li><li class="">14</li><li class="">15</li><li class="">16</li><li class="">17</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-constant-language-import-export-all">*</span> <span class="lsp-meta-import lsp-keyword-control-as">as</span> <span class="lsp-meta-import lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">typescript</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'typescript' or its corresponding type declarations.</li><li class=""></li><li class=""><span class="lsp-meta-enum-declaration lsp-storage-type-enum">enum</span> <span class="lsp-meta-enum-declaration lsp-entity-name-type-enum" ls-info="%5B%5B%22keyword%22,%22enum%22%5D,%22%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D%5D">DiagnosticCategory</span> <span class="lsp-meta-enum-declaration lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Warning%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%220%22%5D%5D">Warning</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Error%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%221%22%5D%5D">Error</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Suggestion%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%222%22%5D%5D">Suggestion</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Message%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%223%22%5D%5D">Message</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-enum-declaration lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D%5D">DiagnosticWithLocation</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D,%22.%22,%5B%22propertyName%22,%22category%22%5D,%22:%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D%5D">category</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22enum%22%5D,%22%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D%5D">DiagnosticCategory</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D,%22.%22,%5B%22propertyName%22,%22code%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D%5D">code</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D,%22.%22,%5B%22propertyName%22,%22file%22%5D,%22:%20ts.SourceFile%22%5D">file</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type-module" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-punctuation-accessor">.</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D,%22.%22,%5B%22aliasName%22,%22SourceFile%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">SourceFile</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D,%22.%22,%5B%22propertyName%22,%22start%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D%5D">start</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D,%22.%22,%5B%22propertyName%22,%22length%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D%5D">length</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticWithLocation%22%5D,%22.%22,%5B%22propertyName%22,%22messageText%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D%5D">messageText</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">string</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type">|</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type-module" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-punctuation-accessor">.</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D,%22.%22,%5B%22aliasName%22,%22DiagnosticMessageChain%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">DiagnosticMessageChain</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<h2 id="%e6%a0%bc%e5%bc%8f%e5%8c%96%e9%94%99%e8%af%af%e6%96%87%e6%9c%ac"><a class="post-anchor" href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e9%94%99%e8%af%af%e6%96%87%e6%9c%ac">§</a>格式化错误文本</h2>
<p>上面的数据结构只有一项是比较麻烦的，那就是<code>messageText</code>数据，我们可以看到它可以是字符串，也可以是<code>DiagnosticMessageChain</code>接口，后者接口对应的是多行错误。</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="lsp-error-start-line"> </li><li class="lsp-error-end-line"> </li><li class="">3</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-function lsp-storage-type-function">function</span> <span class="lsp-meta-function lsp-meta-definition-function lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22function%22%5D,%22%20%22,%5B%22functionName%22,%22transform%22%5D,%22(%22,%5B%22parameterName%22,%22input%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D%5D">transform</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-function lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22input%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D%5D">input</span><span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">string</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-keyword-operator-type">|</span> <span class="lsp-meta-function lsp-meta-parameters lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-function lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-function lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22input%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D,%22%20%7C%20%22,%5B%22keyword%22,%22number%22%5D%5D">input</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-function lsp-meta-block lsp-meta-function-call lsp-support-function lsp-error-token" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">toLowerCase</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-function lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-function lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2339" title="点击查看错误详细信息">[TS2339]</a> Property 'toLowerCase' does not exist on type 'string | number'.</li><li class="lsp-error lsp-error-end-line">  Property 'toLowerCase' does not exist on type 'number'.</li><li class=""><span class="lsp-meta-function lsp-meta-block lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p>这个例子中我们可以看到，<code>input.toLowerCase()</code>方法的错误信息有两行，这是因为类型诊断数据是由<em>Token</em>定义由内向外的，这样更能展示出完整的信息，方便编码者判断错误内容。<br/><span class="post-soft-break"></span>在类似多行的错误时，<code>messageText</code>属性就会是<code>DiagnosticMessageChain</code>接口，可以来看看它的结构——</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="">2</li><li class="">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="">11</li><li class="">12</li><li class="">13</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-enum-declaration lsp-storage-type-enum">enum</span> <span class="lsp-meta-enum-declaration lsp-entity-name-type-enum" ls-info="%5B%5B%22keyword%22,%22enum%22%5D,%22%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D%5D">DiagnosticCategory</span> <span class="lsp-meta-enum-declaration lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Warning%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%220%22%5D%5D">Warning</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Error%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%221%22%5D%5D">Error</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Suggestion%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%222%22%5D%5D">Suggestion</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-enum-declaration lsp-variable-other-enummember" ls-info="%5B%22(enum%20member)%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D,%22.%22,%5B%22enumMemberName%22,%22Message%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20%22,%5B%22numericLiteral%22,%223%22%5D%5D">Message</span><span class="lsp-meta-enum-declaration lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-enum-declaration lsp-punctuation-definition-block">}</span></li><li class=""></li><li class=""><span class="lsp-meta-interface lsp-storage-type-interface">interface</span> <span class="lsp-meta-interface lsp-entity-name-type-interface" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D%5D">DiagnosticMessageChain</span> <span class="lsp-meta-interface lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22.%22,%5B%22propertyName%22,%22messageText%22%5D,%22:%20%22,%5B%22keyword%22,%22string%22%5D%5D">messageText</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">string</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22.%22,%5B%22propertyName%22,%22category%22%5D,%22:%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D%5D">category</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22enum%22%5D,%22%20%22,%5B%22enumName%22,%22DiagnosticCategory%22%5D%5D">DiagnosticCategory</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22.%22,%5B%22propertyName%22,%22code%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D%5D">code</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-support-type-primitive">number</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-definition-property lsp-variable-object-property" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22.%22,%5B%22propertyName%22,%22next%22%5D,%22?:%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22%5B%5D%22%5D">next</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-keyword-operator-optional" ls-info="%5B%22(property)%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22.%22,%5B%22propertyName%22,%22next%22%5D,%22?:%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D,%22%5B%5D%22%5D">?</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22interface%22%5D,%22%20%22,%5B%22interfaceName%22,%22DiagnosticMessageChain%22%5D%5D">DiagnosticMessageChain</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">[</span><span class="lsp-meta-interface lsp-meta-field-declaration lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">]</span><span class="lsp-meta-interface lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-interface lsp-punctuation-definition-block">}</span></li></ul></span></code></pre>
<p><code>DiagnosticMessageChain</code>接口就像是链表一样，使用<code>next</code>属性将所有错误都串联了起来，而且每个数据还可以链接多个数据，这个结构着实有点复杂，如果是我们自己手写<code>formatter</code>的话，需要费一番功夫。然而这其实不用担心！其实 TS 也是考虑了这点的，官方有提供格式化的方法——</p>
<pre class="code-block-wrapper code-block-ls"><label class="code-block-label">TypeScript</label><code class="code-block-list"><ul class="code-block-gutter"><li class="">1</li><li class="lsp-error-start-line lsp-error-end-line"> </li><li class="">2</li><li class="code-block-highlight-line">3</li><li class="">4</li><li class="">5</li><li class="">6</li><li class="">7</li><li class="">8</li><li class="">9</li><li class="">10</li><li class="code-block-highlight-line">11</li><li class="">12</li><li class="">13</li></ul><span class="code-block-box"><ul class="code-block-code"><li class=""><span class="lsp-meta-import lsp-keyword-control-import">import</span> <span class="lsp-meta-import lsp-constant-language-import-export-all">*</span> <span class="lsp-meta-import lsp-keyword-control-as">as</span> <span class="lsp-meta-import lsp-variable-other-readwrite-alias" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span> <span class="lsp-meta-import lsp-keyword-control-from">from</span> <span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-begin lsp-error-token">&#39;</span><span class="lsp-meta-import lsp-string-quoted-single lsp-error-token">typescript</span><span class="lsp-meta-import lsp-string-quoted-single lsp-punctuation-definition-string-end lsp-error-token">&#39;</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class="lsp-error lsp-error-start-line lsp-error-end-line"><a class="lsp-error-goto" target="_blank" rel="noreferrer" href="https://typescript.tv/errors/#ts2307" title="点击查看错误详细信息">[TS2307]</a> Cannot find module 'typescript' or its corresponding type declarations.</li><li class=""></li><li class="code-block-highlight-line"><span class="lsp-meta-var-expr lsp-storage-modifier">declare</span> <span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22rawScriptDiagnostics%22%5D,%22:%20ts.Diagnostic%5B%5D%22%5D">rawScriptDiagnostics</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type-module" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D,%22.%22,%5B%22aliasName%22,%22Diagnostic%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">Diagnostic</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">[</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-meta-type-tuple lsp-meta-brace-square">]</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22host%22%5D,%22:%20ts.FormatDiagnosticsHost%22%5D">host</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-keyword-operator-type-annotation">:</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type-module" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-type-annotation lsp-entity-name-type" ls-info="%5B%5B%22keyword%22,%22type%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D,%22.%22,%5B%22aliasName%22,%22FormatDiagnosticsHost%22%5D,%22%20%22,%5B%22operator%22,%22=%22%5D,%22%20/*unresolved*/%20%22,%5B%22keyword%22,%22any%22%5D%5D">FormatDiagnosticsHost</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-entity-name-function" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22getCurrentDirectory%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">getCurrentDirectory</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single">/</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-entity-name-function" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22getCanonicalFileName%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">getCanonicalFileName</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-entity-name-function" ls-info="%5B%22(property)%20%22,%5B%22propertyName%22,%22getNewLine%22%5D,%22:%20()%20=%3E%20%22,%5B%22keyword%22,%22string%22%5D%5D">getNewLine</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-object-literal-key lsp-punctuation-separator-key-value">:</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-begin">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-constant-character-escape">\n</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-meta-object-member lsp-string-quoted-single lsp-punctuation-definition-string-end">&#39;</span><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-separator-comma">,</span></li><li class=""><span class="lsp-meta-var-expr lsp-meta-objectliteral lsp-punctuation-definition-block">}</span><span class="lsp-punctuation-terminator-statement">;</span></li><li class=""></li><li class=""><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">/**</span><span class="lsp-comment-block-documentation"> 格式化的错误文本 </span><span class="lsp-comment-block-documentation lsp-punctuation-definition-comment">*/</span></li><li class="code-block-highlight-line"><span class="lsp-meta-var-expr lsp-storage-type">const</span> <span class="lsp-meta-var-expr lsp-meta-var-single-variable-expr lsp-meta-definition-variable lsp-variable-other-constant" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22diagnosticsFormatted%22%5D,%22:%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D%22%5D">diagnosticsFormatted</span> <span class="lsp-meta-var-expr lsp-keyword-operator-assignment">=</span> <span class="lsp-meta-var-expr lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22rawScriptDiagnostics%22%5D,%22:%20ts.Diagnostic%5B%5D%22%5D">rawScriptDiagnostics</span><span class="lsp-meta-var-expr lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%22(method)%20%22,%5B%22localName%22,%22Array%22%5D,%22%3Cts.Diagnostic%3E.%22,%5B%22methodName%22,%22map%22%5D,%22%3C%22,%5B%22keyword%22,%22any%22%5D,%22%3E(%22,%5B%22parameterName%22,%22callbackfn%22%5D,%22:%20(%22,%5B%22parameterName%22,%22value%22%5D,%22:%20ts.Diagnostic,%20%22,%5B%22parameterName%22,%22index%22%5D,%22:%20%22,%5B%22keyword%22,%22number%22%5D,%22,%20%22,%5B%22parameterName%22,%22array%22%5D,%22:%20ts.Diagnostic%5B%5D)%20=%3E%20%22,%5B%22keyword%22,%22any%22%5D,%22,%20%22,%5B%22parameterName%22,%22thisArg%22%5D,%22?:%20%22,%5B%22keyword%22,%22any%22%5D,%22):%20%22,%5B%22keyword%22,%22any%22%5D,%22%5B%5D%22%5D">map</span><span class="lsp-meta-var-expr lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-begin">(</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-parameters lsp-variable-parameter" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22data%22%5D,%22:%20ts.Diagnostic%22%5D">data</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-parameters lsp-punctuation-definition-parameters-end">)</span> <span class="lsp-meta-var-expr lsp-meta-arrow lsp-storage-type-function-arrow">=&gt;</span> <span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">{</span></li><li class=""><span class="code-block-split"></span>  <span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-keyword-control-flow">return</span> <span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-variable-other-object" ls-info="%5B%5B%22keyword%22,%22import%22%5D,%22%20%22,%5B%22aliasName%22,%22ts%22%5D%5D">ts</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-punctuation-accessor">.</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-meta-function-call lsp-entity-name-function" ls-info="%5B%5B%22keyword%22,%22any%22%5D%5D">formatDiagnostic</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">(</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%22(parameter)%20%22,%5B%22parameterName%22,%22data%22%5D,%22:%20ts.Diagnostic%22%5D">data</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-punctuation-separator-comma">,</span> <span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-variable-other-readwrite" ls-info="%5B%5B%22keyword%22,%22const%22%5D,%22%20%22,%5B%22localName%22,%22host%22%5D,%22:%20ts.FormatDiagnosticsHost%22%5D">host</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-meta-brace-round">)</span><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-punctuation-terminator-statement">;</span></li><li class=""><span class="lsp-meta-var-expr lsp-meta-arrow lsp-meta-block lsp-punctuation-definition-block">}</span><span class="lsp-meta-var-expr lsp-meta-brace-round">)</span><span class="lsp-punctuation-terminator-statement">;</span></li></ul></span></code></pre>
<p>第<code>4</code>和<code>12</code>行的高亮就是这个格式化方法的用法，这里仍然需要个格式化方法的<code>Host</code>实体，不过内容并不多，只需要提供<em>换行</em>、<em>文件名格式化方法</em>、<em>当前工作路径</em>三个参数即可，可以按照自己语言服务的情况来提供。</p>
<h2 id="%e8%af%a6%e7%bb%86%e9%94%99%e8%af%af%e8%a7%a3%e9%87%8a"><a class="post-anchor" href="#%e8%af%a6%e7%bb%86%e9%94%99%e8%af%af%e8%a7%a3%e9%87%8a">§</a>详细错误解释</h2>
<p>很多时候，我们即便是看了具体的错误仍然不知道这错误是啥意思……TS 官网也没给每个错误的对应表。于是我找了个<a target="_blank" rel="noreferrer" href="https://typescript.tv/errors/">开源网站</a>，对每个<code>Error Code</code>做了个跳转，每个错误文本开头的<code>[TS数字]</code>符号都是可以直接点击跳转到对应的错误解释，还是很方便的。</p></article></section><aside class="to-content"><header class="menu-list-header">目录</header><article class="menu-list-article"><ul class="menu-list"><li class="menu-item menu-level1"><a href="#%e5%8a%9f%e8%83%bd%e5%b1%95%e7%a4%ba"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>功能展示</a></li><li class="menu-item menu-level1"><a href="#%e5%8e%9f%e7%90%86%e8%ae%b2%e8%a7%a3"><i data-name="circle" class="icon-box menu-icon"><svg viewBox="0 0 8 8" version="1.1" width="1em" height="1em" aria-hidden="true" fill="currentColor"><path d="M 4, 4 m -3, 0 a 3,3 0 1,0 6,0 a 3,3 0 1,0 -6,0"></path></svg></i>原理讲解</a><ul class="menu-list"><li class="menu-item menu-level2"><a href="#%e8%8e%b7%e5%8f%96%e9%94%99%e8%af%af%e6%95%b0%e6%8d%ae">获取错误数据</a></li><li class="menu-item menu-level2"><a href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e9%94%99%e8%af%af%e6%96%87%e6%9c%ac">格式化错误文本</a></li><li class="menu-item menu-level2"><a href="#%e8%af%a6%e7%bb%86%e9%94%99%e8%af%af%e8%a7%a3%e9%87%8a">详细错误解释</a></li></ul></li></ul></article></aside></div></article><footer class="main-footer"><span>Powered by </span><a href="https://github.com/xiaoboost" class="main-footer-href">Xiao</a><span> &amp; </span><a href="https://pages.github.com/" class="main-footer-href">Github Pages</a><span style="font-size:110%"> © </span><span>Since 2020</span></footer><div class="goto-top"><button class="goto-top-btn"><svg fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M16.036 19.59a1 1 0 0 1-.997.995H9.032a.996.996 0 0 1-.997-.996v-7.005H5.03c-1.1 0-1.36-.633-.578-1.416L11.33 4.29a1.003 1.003 0 0 1 1.412 0l6.878 6.88c.782.78.523 1.415-.58 1.415h-3.004v7.005z"></path></svg></button></div><div data-width="8" data-mode="y" class="scrollbar invisible"><div class="slider"></div></div><script type="text/javascript" src="/scripts/layout.a1cf0ac821123b4e55217ecaae515f88.js"></script><script type="text/javascript" src="/scripts/post.3a108c44d494dcfb1ab471f7db3d5348.js"></script></body></html>